<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindset for IELTS 1 - Unit 3 Speaking</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom CSS from your original file */
        body {
            font-family: 'Inter', sans-serif;
        }
        .correct-feedback {
            color: #10B981; /* Green-500 */
        }
        .incorrect-feedback {
            color: #EF4444; /* Red-500 */
        }
        .feedback-box {
            padding: 0.5rem 0.75rem;
            margin-top: 0.5rem;
            border-radius: 0.375rem; /* rounded-md */
            font-size: 0.875rem; /* text-sm */
        }
        .feedback-box.correct {
            background-color: #D1FAE5; /* green-100 */
            border: 1px solid #34D399; /* green-400 */
        }
        .feedback-box.incorrect {
            background-color: #FEE2E2; /* red-100 */
            border: 1px solid #F87171; /* red-400 */
        }
        /* Message Box for Save Confirmation */
        #message-box {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4CAF50; /* Green */
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        #message-box.show {
            opacity: 1;
        }
        .video-container {
            padding: 56.25% 0 0 0;
            position: relative;
            margin-bottom: 1.5rem; /* Equivalent to mb-6 */
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0.5rem; /* For rounded-lg effect */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* For shadow-md effect */
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100 p-4 font-sans text-gray-800">

    <div class="max-w-4xl mx-auto bg-white p-6 md:p-8 rounded-xl shadow-lg">
        <h1 class="text-3xl md:text-4xl font-bold text-center text-indigo-700 mb-8">
            Mindset for IELTS 1 - Unit 3 Speaking
        </h1>

        <div class="flex justify-end mb-6 space-x-2">
            <button id="clear-all-answers-button" class="px-4 py-2 bg-red-500 text-white rounded-lg shadow-md hover:bg-red-600 transition duration-200 ease-in-out transform hover:scale-105">
                Clear All Answers
            </button>
        </div>

        <!-- Unit 3: Exercise 1 -->
        <section class="mb-10 p-6 bg-indigo-50 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-indigo-600 mb-4">Unit 3: Exercise 1</h2>
            <p class="mb-4">Match each job with the correct picture.</p>
            <div id="exercise1-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Content will be dynamically loaded here -->
            </div>
            <div class="flex justify-end mt-6">
                <button id="check-ex1-button" class="px-5 py-2 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 transition duration-200 ease-in-out transform hover:scale-105">
                    Check Exercise 1
                </button>
            </div>
        </section>

        <!-- Unit 3: Exercise 2 -->
        <section class="mb-10 p-6 bg-blue-50 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-blue-600 mb-4">Unit 3: Exercise 2</h2>
            <p class="mb-4">Read the task card and watch the video of the student doing IELTS Speaking Part 2. She makes some mistakes with verb forms. Find and correct the mistakes.</p>

            <!-- Exercise 2 Video -->
            <div class="video-container">
                <iframe src="https://player.vimeo.com/video/1090746991?h=efd27bd502&amp;badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479&amp;dnt=1" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media" title="Speaking_Exercise2"></iframe>
            </div>
            <script src="https://player.vimeo.com/api/player.js"></script>

            <div class="bg-white p-4 rounded-md border border-gray-300 mb-4">
                <p class="font-mono text-gray-700 leading-relaxed mb-2">"In the IELTS Speaking exam, 25% of your mark is based on grammatical range and accuracy. Grammatical range means using a variety of tenses and types of sentence. Accuracy means not making mistakes.",One way to improve your accuracy is to use correct verb forms.</p>
                <p class="font-bold text-gray-800 mb-2">Describe a job you would like to have. </p>
                <p class="font-mono text-gray-700 leading-relaxed">
                    I would like introduce a job which I would like to do in the future.
                    My dream job is be a teacher.
                    I really like get on with children.
                    A lot of my classmates be teachers now.
                    I wanted to do this job since I started university.
                </p>
            </div>
            <p class="mb-2 font-medium">Type your corrected text below:</p>
            <textarea id="ex2-user-corrections" class="w-full p-3 border rounded-md focus:ring-blue-500 focus:border-blue-500 h-32 resize-y" placeholder="Write your corrected sentences here..."></textarea>
            <div class="mt-4">
                <div id="ex2-feedback" class="hidden feedback-box"></div>
                <p class="text-sm text-gray-600 mt-2">
                    Note: This check is basic and looks for the presence of corrected phrases.
                </p>
            </div>
            <div class="flex justify-end mt-6">
                <button id="check-ex2-button" class="px-5 py-2 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 transition duration-200 ease-in-out transform hover:scale-105">
                    Check Exercise 2
                </button>
            </div>
        </section>

        <!-- Unit 3: Exercise 3 -->
        <section class="mb-10 p-6 bg-green-50 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-green-600 mb-4">Unit 3: Exercise 3</h2>
            <p class="mb-4">Complete the sentences with the correct form of the verbs in brackets.</p>
            <div id="exercise3-container" class="space-y-4">
                <!-- Content will be dynamically loaded here -->
            </div>
            <div class="flex justify-end mt-6">
                <button id="check-ex3-button" class="px-5 py-2 bg-green-600 text-white rounded-lg shadow-md hover:bg-green-700 transition duration-200 ease-in-out transform hover:scale-105">
                    Check Exercise 3
                </button>
            </div>
        </section>

        <!-- Unit 3: Exercise 4 -->
        <section class="mb-10 p-6 bg-purple-50 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-purple-600 mb-4">Unit 3: Exercise 4</h2>
            <p class="mb-4">Read the information. Then watch the videos of students doing IELTS Speaking tests. Sometimes they make mistakes. Choose the correct answers to complete the sentences.</p>
            
            <!-- Exercise 4 Videos -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <p class="font-semibold text-purple-700 mb-2">Video 4.1:</p>
                    <div class="video-container">
                        <iframe src="https://player.vimeo.com/video/1090747011?h=bc9d6e3783&amp;badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479&amp;dnt=1" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media" title="Speaking_Exercise4_1"></iframe>
                    </div>
                </div>
                <div>
                    <p class="font-semibold text-purple-700 mb-2">Video 4.2:</p>
                    <div class="video-container">
                        <iframe src="https://player.vimeo.com/video/1090747021?h=cbd1281a27&amp;badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479&amp;dnt=1" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media" title="Speaking_Exercise4_2"></iframe>
                    </div>
                </div>
                <div>
                    <p class="font-semibold text-purple-700 mb-2">Video 4.3:</p>
                    <div class="video-container">
                        <iframe src="https://player.vimeo.com/video/1090746925?h=1da35a7549&amp;badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479&amp;dnt=1" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen="" frameborder="0" title="Speaking_Exercise4_3"></iframe>
                    </div>
                </div>
                <div>
                    <p class="font-semibold text-purple-700 mb-2">Video 4.4:</p>
                    <div class="video-container">
                        <iframe src="https://player.vimeo.com/video/1090746941?h=c796e413df&amp;badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479&amp;dnt=1" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media" title="Speaking_Exercise4_4"></iframe>
                    </div>
                </div>
            </div>
            <script src="https://player.vimeo.com/api/player.js"></script>

            <div class="bg-white p-4 rounded-md border border-gray-300 mb-4">
                <p class="font-mono text-gray-700 leading-relaxed">"Another way to improve your accuracy in the IELTS Speaking test is to use correct articles (a, an, the)."</p>
            </div>
            <div id="exercise4-container" class="space-y-4">
                <!-- Content will be dynamically loaded here -->
            </div>
            <div class="flex justify-end mt-6">
                <button id="check-ex4-button" class="px-5 py-2 bg-purple-600 text-white rounded-lg shadow-md hover:bg-purple-700 transition duration-200 ease-in-out transform hover:scale-105">
                    Check Exercise 4
                </button>
            </div>
        </section>

        <!-- Unit 3: Exercise 5 -->
        <section class="mb-10 p-6 bg-yellow-50 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-yellow-700 mb-4">Unit 3: Exercise 5</h2>
            <p class="mb-4">Complete the sentences using a, an or the.</p>
            <div id="exercise5-container" class="space-y-4">
                <!-- Content will be dynamically loaded here -->
            </div>
            <div class="flex justify-end mt-6">
                <button id="check-ex5-button" class="px-5 py-2 bg-yellow-600 text-white rounded-lg shadow-md hover:bg-yellow-700 transition duration-200 ease-in-out transform hover:scale-105">
                    Check Exercise 5
                </button>
            </div>
        </section>

        <!-- Unit 3: Exercise 6 -->
        <section class="mb-10 p-6 bg-red-50 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-red-600 mb-4">Unit 3: Exercise 6</h2>
            <p class="mb-4">Grammatical range means using a variety of tenses and types of sentences. You can improve your grammatical range by using a variety of phrases. Read the task card. Then watch the video of a student doing IELTS Speaking Part 2 and look at the sentences she uses. Match the phrases in the box with the underlined words which have a similar meaning.</p>
            
            <!-- Exercise 6 Video -->
            <div class="video-container">
                <iframe src="https://player.vimeo.com/video/1090746953?h=0126882f1c&amp;badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479&amp;dnt=1" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen="" frameborder="0" title="Speaking_Exercise6"></iframe>
            </div>
            <script src="https://player.vimeo.com/api/player.js"></script>

            <div class="bg-white p-4 rounded-md border border-gray-300 mb-4">
                <p class="font-bold text-gray-800 mb-2">Describe a job you would like to have.</p>
                <p class="font-mono text-gray-700 leading-relaxed">
                    You should say: what the job is what you know about that job what study or training you would need to do so you can get that job and explain why you would like to have that job.
                </p>
            </div>
            <div class="mb-4 p-3 bg-red-100 rounded-md border border-red-200">
                <p class="font-semibold">Phrases: I have always thought ..., It is said that ..., I’d like to talk about ..., it is necessary to, to become</p>
            </div>
            <div id="exercise6-container" class="space-y-4">
                <!-- Content will be dynamically loaded here -->
            </div>
            <div class="flex justify-end mt-6">
                <button id="check-ex6-button" class="px-5 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition duration-200 ease-in-out transform hover:scale-105">
                    Check Exercise 6
                </button>
            </div>
        </section>

        <!-- Unit 3: Exercise 7 -->
        <section class="mb-10 p-6 bg-teal-50 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-teal-600 mb-4">Unit 3: Exercise 7</h2>
            <p class="mb-4">Grammatical range means using a variety of tenses and types of sentences. You can improve your grammatical range by using a variety of phrases. Read the task card. Then watch the video of a student doing IELTS Speaking Part 2 and look at the sentences he uses. Add a phrase from the box to each sentence. This will help improve the grammatical range.</p>
            
            <!-- Exercise 7 Video -->
            <div class="video-container">
                <iframe src="https://player.vimeo.com/video/1090746972?h=11671c550b&amp;badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479&amp;dnt=1" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen="" frameborder="0" title="Speaking_Exercise7"></iframe>
            </div>
            <script src="https://player.vimeo.com/api/player.js"></script>

            <div class="bg-white p-4 rounded-md border border-gray-300 mb-4">
                <p class="font-bold text-gray-800 mb-2">Describe a job you would like to have.</p>
                <p class="font-mono text-gray-700 leading-relaxed">
                    You should say: what the job is what you know about that job what study or training you would need to do so you can get that job and explain why you would like to have that job.
                </p>
            </div>
            <div class="mb-4 p-3 bg-teal-100 rounded-md border border-teal-200">
                <p class="font-semibold">Phrases: Following that, I have always thought that, It is said that, Most importantly, What’s more,</p>
            </div>
            <div id="exercise7-container" class="space-y-4">
                <!-- Content will be dynamically loaded here -->
            </div>
            <div class="flex justify-end mt-6">
                <button id="check-ex7-button" class="px-5 py-2 bg-teal-600 text-white rounded-lg shadow-md hover:bg-teal-700 transition duration-200 ease-in-out transform hover:scale-105">
                    Check Exercise 7
                </button>
            </div>
        </section>

        <!-- Unit 3: Exercise 8 -->
        <section class="mb-10 p-6 bg-orange-50 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-orange-600 mb-4">Unit 3: Exercise 8</h2>
            <p class="mb-4">Put the words in the correct order to complete the sentences.</p>
            <div id="exercise8-container" class="space-y-4">
                <!-- Content will be dynamically loaded here -->
            </div>
            <div class="flex justify-end mt-6">
                <button id="check-ex8-button" class="px-5 py-2 bg-orange-600 text-white rounded-lg shadow-md hover:bg-orange-700 transition duration-200 ease-in-out transform hover:scale-105">
                    Check Exercise 8
                </button>
            </div>
        </section>

        <!-- Unit 3: Exercise 9 -->
        <section class="mb-10 p-6 bg-pink-50 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-pink-600 mb-4">Unit 3: Exercise 9</h2>
            <p class="mb-4">What have you learnt about grammatical range and accuracy in the IELTS Speaking test in this unit? Choose the correct answers.</p>
            <div id="exercise9-container" class="space-y-4">
                <!-- Content will be dynamically loaded here -->
            </div>
            <div class="flex justify-end mt-6">
                <button id="check-ex9-button" class="px-5 py-2 bg-pink-600 text-white rounded-lg shadow-md hover:bg-pink-700 transition duration-200 ease-in-out transform hover:scale-105">
                    Check Exercise 9
                </button>
            </div>
        </section>

        <!-- Unit 3: Exercise 10 -->
        <section class="mb-10 p-6 bg-gray-50 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Unit 3: Exercise 10 - IELTS Speaking Part 2</h2>
            <p class="mb-4">You are going to do IELTS Speaking Part 2. You will need some paper and a pencil.</p>
            <p class="mb-4 font-semibold">Describe a job you would like to have.</p>
            <ul class="list-disc list-inside mb-6 ml-4 text-gray-700">
                <li>what the job is</li>
                <li>what you know about that job</li>
                <li>what study or training you would need to do so you can get that job</li>
                <li>and explain why you would like to have that job.</li>
            </ul>
            <p class="mb-2 font-medium">Your answer:</p>
            <textarea id="ex10-text" class="w-full p-3 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500 h-48 resize-y" placeholder="Type your answer here..."></textarea>
            <div class="mt-4 text-sm text-gray-600">
                Word count: <span id="ex10-word-count">0</span>
            </div>
        </section>

    </div>

    <div id="message-box"></div>

    <script>
        // Global state object
        let appState = {
            exercise1Answers: {},
            exercise2UserCorrections: '',
            exercise3Answers: {},
            exercise4Answers: {},
            exercise5Answers: {},
            exercise6Answers: {},
            exercise7Answers: {},
            exercise8Answers: {},
            exercise9Answers: {},
            exercise10Text: '',
        };

        // --- Data for Exercises ---

        // Exercise 1 Data (Jobs and assumed picture numbers)
        const exercise1Jobs = [
            { name: 'Mechanic', pictureNum: '1', image: 'https://i.postimg.cc/yYLW0Rv1/Speaking-Unit3-Exercise1-Picture1.jpg' },
            { name: 'architect', pictureNum: '2', image: 'https://i.postimg.cc/2jF18MWB/Speaking-Unit3-Exercise1-Picture2.jpg' },
            { name: 'pilot', pictureNum: '3', image: 'https://i.postimg.cc/kGcG1RCy/Speaking-Unit3-Exercise1-Picture3.jpg' },
            { name: 'chef', pictureNum: '4', image: 'https://i.postimg.cc/jS95FrpB/Speaking-Unit3-Exercise1-Picture4.jpg' },
            { name: 'scientist', pictureNum: '5', image: 'https://i.postimg.cc/1zqtxjPX/Speaking-Unit3-Exercise1-Picture5.jpg' },
            { name: 'manager', pictureNum: '6', image: 'https://i.postimg.cc/vZDThmNW/Speaking-Unit3-Exercise1-Picture6.jpg' },
            { name: 'Professor', pictureNum: '7', image: 'https://i.postimg.cc/Hx1LT9s2/Speaking-Unit3-Exercise1-Picture7.jpg' },
            { name: 'journalist', pictureNum: '8', image: 'https://i.postimg.cc/5N46Hg5K/Speaking-Unit3-Exercise1-Picture8.jpg' },
        ];
        // Now using job names for options
        const exercise1PictureOptions = exercise1Jobs.map(job => job.name);

        // Exercise 2 Data (Corrected paragraph)
        const exercise2CorrectedText = `I would like to introduce a job which I would like to do in the future. My dream job is to be a teacher. I really like to get on with children. A lot of my classmates are teachers now. I have wanted to do this job since I started university.`;
        const exercise2ExpectedCorrections = [
            { original: 'like introduce', corrected: 'like to introduce' },
            { original: 'is be', corrected: 'is to be' },
            { original: 'like get on', corrected: 'like to get on' },
            { original: 'classmates be', corrected: 'classmates are' },
            { original: 'I wanted', corrected: 'I have wanted' }
        ];

        // Exercise 3 Data (Verb forms)
        const exercise3Sentences = [
            { text: 'When I finish university I ________ to be a scientist. (want)', correct: 'want' },
            { text: 'The exam yesterday ________ really difficult. (be)', correct: 'was' },
            { text: 'I am ________ to walk to work today. (go)', correct: 'going' },
            { text: 'I ________ been a mechanic since 2014. (have)', correct: 'have' },
            { text: 'I’m ________ on an interesting project at the moment. (work)', correct: 'working' },
            { text: 'The information that my manager ________ me last week was useful. (give)', correct: 'gave' },
            { text: 'The workers ________ to be careful with the new machine. It’s quite difficult to use. (need)', correct: 'need' },
            { text: 'This work that we’re ________ is so interesting! (do)', correct: 'doing' },
        ];

        // Exercise 4 Data (Articles - a, an, the, -)
        const exercise4Questions = [
            {
                text: '1. Some people say this is not ______ very well-paid job, but it’s ______ very stable job.',
                blanks: [
                    { options: ['a', 'an', 'the', '-'], correct: 'a' },
                    { options: ['a', 'an', 'the', '-'], correct: 'a' }
                ]
            },
            {
                text: '2. To be ______ professor I need ______ doctor’s degree.',
                blanks: [
                    { options: ['a', 'an', 'the', '-'], correct: 'a' },
                    { options: ['a', 'an', 'the', '-'], correct: 'a' }
                ]
            },
            {
                text: '3. If I have ______ opportunity, I will train myself in ______ skills of teaching.',
                blanks: [
                    { options: ['a', 'an', 'the', '-'], correct: 'an' },
                    { options: ['a', 'an', 'the', '-'], correct: 'the' }
                ]
            },
            {
                text: '4. My mother is ______ elementary school teacher.',
                blanks: [
                    { options: ['a', 'an', 'the', '-'], correct: 'an' }
                ]
            }
        ];

        // Exercise 5 Data (Articles - a, an, or the)
        const exercise5Sentences = [
            { text: 'I paid _______ money I was given as a present into my bank account.', correct: 'the' },
            { text: 'It would be a good idea to find ________ architect to plan the new head office building.', correct: 'an' },
            { text: '_______ pilot landed the plane early because the weather was so bad.', correct: 'the' },
            { text: '_______ celebrity’s life is never easy.', correct: 'A' },
            { text: 'My aunt works as ________ hairdresser.', correct: 'a' },
            { text: '_______ best thing about being a scientist is that you can follow your interests.', correct: 'The' },
            { text: 'My favourite professor does not teach at ______ weekend.', correct: 'the' },
            { text: 'Do you know _______ mechanic who could fix my car?', correct: 'a' },
            { text: 'I never planned to be _______ chef. It just happened.', correct: 'a' },
            { text: 'My friend is a journalist and has just published _______ article.', correct: 'an' },
        ];
        const exercise5Options = ['a', 'an', 'the', '-'];

        // Exercise 6 Data (Matching phrases)
        const exercise6Phrases = [
            'I have always thought ...',
            'It is said that ...',
            'I’d like to talk about ...',
            'it is necessary to',
            'to become'
        ];
        const exercise6Matches = [
            { sentence: 'I would like to introduce a job which I would like to do in the future.', correctPhrase: 'I’d like to talk about ...' },
            { sentence: 'My dream job is to be a teacher.', correctPhrase: 'to become' }, // Closest meaning
            { sentence: 'To be a teacher, you need to train.', correctPhrase: 'it is necessary to' },
            { sentence: 'Some people say this is not a well-paid job.', correctPhrase: 'It is said that ...' },
            { sentence: 'I think this job would suit me.', correctPhrase: 'I have always thought ...' },
        ];

        // Exercise 7 Data (Adding phrases)
        const exercise7Phrases = [
            'Following that,',
            'I have always thought that',
            'It is said that',
            'Most importantly,',
            'What’s more,'
        ];
        const exercise7Sentences = [
            { text: '______ the job I would like to have is professor.', correct: 'Most importantly,' },
            { text: '______ professors can usually study something that they want, ... and also study alone.', correct: 'I have always thought that' },
            { text: 'I would also like to teach ... because my parents are teachers. ... ______ I used to teach my friends.', correct: 'What’s more,' },
            { text: '______ to be a professor I need a doctorate.', correct: 'It is said that' },
            { text: '______ I’d go to another country, like England, to get a post-doctoral job.', correct: 'Following that,' }
        ];

        // Exercise 8 Data (Word order)
        const exercise8ScrambledSentences = [
            { scrambled: ['dream', 'job.', 'like to', 'talk about', 'my', 'I would'], correct: 'I would like to talk about my dream job.' },
            { scrambled: ['Job', 'would', 'that', 'this', 'thought', 'suit me.', 'I have always'], correct: 'I have always thought that this job would suit me.' },
            { scrambled: ["Well-paid", "'s", "'s more,", "job.", "it", "a", "What"], correct: "What's more, it's a well-paid job." },
            { scrambled: ["A teacher.", "You can become", "before", "necessary", "study", "'s", "to", "It"], correct: "It's necessary to study before you can become a teacher." },
            { scrambled: ["Importantly,", "have", "work abroad.", "To", "'ll", "I", "the opportunity", "Most"], correct: "Most importantly, I'll have the opportunity to work abroad." },
            { scrambled: ["That,", "can", "countries.", "I", "live and work", "many", "in", "Follwing"], correct: "Following that, I can live and work in many countries." },
            { scrambled: ["Best", "in the world.", "Job", "the", "people", "that it's", "say", "Some"], correct: "Some people say that it's the best job in the world." },
            { scrambled: ["Dream", "to", "become", "is", "job", "teacher.", "a", "My"], correct: "My dream job is to become a teacher." }
        ];

        // Exercise 9 Data (Multiple choice)
        const exercise9Questions = [
            {
                question: 'How much of the IELTS Speaking score is based on grammatical range and accuracy?',
                options: ['25%', '50%'],
                correct: '25%'
            },
            {
                question: 'Grammatical range means:',
                options: ['using a good variety of tenses, phrases and types of sentences.', 'using correct grammar.'],
                correct: 'using a good variety of tenses, phrases and types of sentences.'
            },
            {
                question: 'Grammatical accuracy means:',
                options: ['using a range of grammar.', 'not making mistakes.'],
                correct: 'not making mistakes.'
            },
            {
                question: 'You can improve your grammatical range by:',
                options: ['using correct verb forms.', 'using a variety of phrases.'],
                correct: 'using a variety of phrases.'
            },
            {
                question: 'You can improve your grammatical accuracy by:',
                options: ['using a variety of tenses.', 'correctly using articles and verbs.'],
                correct: 'correctly using articles and verbs.'
            }
        ];

        // --- Helper Functions ---
        function getElement(id) {
            return document.getElementById(id);
        }

        function setFeedback(elementId, isCorrect, correctText = '') {
            const element = getElement(elementId);
            if (!element) return;
            element.classList.remove('hidden');
            element.classList.remove('correct-feedback', 'incorrect-feedback');
            element.textContent = ''; // Clear previous text

            if (isCorrect) {
                element.classList.add('correct-feedback');
                element.textContent = '✓ Correct!';
            } else {
                element.classList.add('incorrect-feedback');
                element.textContent = `✗ Incorrect.`; // Removed correctText here, as per instructions for feedback
            }
        }

        function clearFeedback(elementId) {
            const element = getElement(elementId);
            if (element) {
                element.classList.add('hidden');
                element.classList.remove('correct-feedback', 'incorrect-feedback');
                element.textContent = '';
            }
        }

        // Function to show a temporary message
        function showMessage(message, type = 'success') {
            const messageBox = getElement('message-box');
            messageBox.textContent = message;
            messageBox.className = ''; // Clear previous classes
            messageBox.classList.add('show');
            if (type === 'success') {
                messageBox.style.backgroundColor = '#4CAF50';
            } else if (type === 'error') {
                messageBox.style.backgroundColor = '#f44336';
            }
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 3000);
        }

        // --- Save/Load Functions ---
        function saveAnswers() {
            try {
                localStorage.setItem('unit3SpeakingAppState', JSON.stringify(appState));
            } catch (e) {
                console.error("Error saving to local storage:", e);
            }
        }

        function loadAnswers() {
            try {
                const savedState = localStorage.getItem('unit3SpeakingAppState');
                if (savedState) {
                    appState = JSON.parse(savedState); // Overwrite appState with saved data

                    // Populate Exercise 1 dropdowns
                    exercise1Jobs.forEach(job => {
                        const select = getElement(`ex1-select-${job.name.replace(/\s/g, '-')}`);
                        if (select && appState.exercise1Answers[job.name] !== undefined) {
                            select.value = appState.exercise1Answers[job.name];
                        }
                    });

                    // Populate Exercise 2 textarea
                    const ex2Textarea = getElement('ex2-user-corrections');
                    if (ex2Textarea && appState.exercise2UserCorrections !== undefined) {
                        ex2Textarea.value = appState.exercise2UserCorrections;
                    }

                    // Populate Exercise 3 inputs
                    exercise3Sentences.forEach((sentence, index) => {
                        const input = getElement(`ex3-input-${index}`);
                        if (input && appState.exercise3Answers[index] !== undefined) {
                            input.value = appState.exercise3Answers[index];
                        }
                    });

                    // Populate Exercise 4 inputs (radio buttons)
                    exercise4Questions.forEach((q, qIndex) => {
                        q.blanks.forEach((blank, bIndex) => {
                            if (appState.exercise4Answers[`q${qIndex}b${bIndex}`] !== undefined) {
                                const selectedValue = appState.exercise4Answers[`q${qIndex}b${bIndex}`];
                                const radio = getElement(`ex4-q${qIndex}b${bIndex}-${selectedValue.replace(/^-$/, 'dash')}`);
                                if (radio) radio.checked = true;
                            }
                        });
                    });

                    // Populate Exercise 5 dropdowns
                    exercise5Sentences.forEach((sentence, index) => {
                        const select = getElement(`ex5-select-${index}`);
                        if (select && appState.exercise5Answers[index] !== undefined) {
                            select.value = appState.exercise5Answers[index];
                        }
                    });

                    // Populate Exercise 6 dropdowns
                    exercise6Matches.forEach((match, index) => {
                        const select = getElement(`ex6-select-${index}`);
                        if (select && appState.exercise6Answers[index] !== undefined) {
                            select.value = appState.exercise6Answers[index];
                        }
                    });

                    // Populate Exercise 7 dropdowns
                    exercise7Sentences.forEach((sentence, index) => {
                        const select = getElement(`ex7-select-${index}`);
                        if (select && appState.exercise7Answers[index] !== undefined) {
                            select.value = appState.exercise7Answers[index];
                        }
                    });

                     // Populate Exercise 8 inputs
                    exercise8ScrambledSentences.forEach((sentence, index) => {
                        const input = getElement(`ex8-input-${index}`);
                        if (input && appState.exercise8Answers[index] !== undefined) {
                            input.value = appState.exercise8Answers[index];
                        }
                    });

                    // Populate Exercise 9 inputs (radio buttons)
                    exercise9Questions.forEach((q, qIndex) => {
                        if (appState.exercise9Answers[qIndex] !== undefined) {
                            const selectedValue = appState.exercise9Answers[qIndex];
                            // Escape special characters in option text for ID
                            const safeOptionId = selectedValue.replace(/[^a-zA-Z0-9]/g, '');
                            const radio = getElement(`ex9-q${qIndex}-option-${safeOptionId}`);
                            if (radio) radio.checked = true;
                        }
                    });


                    // Populate Exercise 10 textarea and word count
                    const ex10Textarea = getElement('ex10-text');
                    const ex10WordCount = getElement('ex10-word-count');
                    if (ex10Textarea && appState.exercise10Text !== undefined) {
                        ex10Textarea.value = appState.exercise10Text;
                        ex10WordCount.textContent = ex10Textarea.value.split(/\s+/).filter(word => word.length > 0).length;
                    }
                }
            } catch (e) {
                console.error("Error loading from local storage:", e);
            }
        }


        // --- Exercise Initialization Functions ---

        function initializeExercise1() {
            const container = getElement('exercise1-container');
            exercise1Jobs.forEach(job => {
                const itemDiv = document.createElement('div');
                itemDiv.className = "flex flex-col items-center p-3 border border-indigo-200 rounded-md bg-white text-center";

                const img = document.createElement('img');
                img.src = job.image;
                img.alt = job.name;
                img.className = "w-24 h-24 object-contain rounded-md mb-2";
                img.onerror = function() { this.src = 'https://placehold.co/96x96/CCCCCC/333333?text=Job'; };
                itemDiv.appendChild(img);

                const jobNamePara = document.createElement('p');
                jobNamePara.className = "font-medium text-lg text-indigo-800 mb-2";
                jobNamePara.textContent = `Picture ${job.pictureNum}:`; // Display picture number as text
                itemDiv.appendChild(jobNamePara);

                const select = document.createElement('select');
                select.id = `ex1-select-${job.name.replace(/\s/g, '-')}`;
                select.className = "p-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500 w-full text-center";
                
                const defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = "Select a Job";
                select.appendChild(defaultOption);

                // Populate options with job names
                exercise1Jobs.forEach(optionJob => {
                    const option = document.createElement('option');
                    option.value = optionJob.name; // Value is the job name
                    option.textContent = optionJob.name; // Display is the job name
                    select.appendChild(option);
                });

                select.addEventListener('change', (event) => {
                    appState.exercise1Answers[job.name] = event.target.value; // Store the selected job name
                    saveAnswers();
                });
                itemDiv.appendChild(select);

                const feedbackSpan = document.createElement('span');
                feedbackSpan.id = `ex1-feedback-${job.name.replace(/\s/g, '-')}`;
                feedbackSpan.className = "hidden mt-2";
                itemDiv.appendChild(feedbackSpan);

                container.appendChild(itemDiv);
            });
            getElement('check-ex1-button').addEventListener('click', checkExercise1);
        }

        function checkExercise1() {
            exercise1Jobs.forEach(job => {
                const userAnswer = appState.exercise1Answers[job.name] || '';
                // Compare the selected job name with the current job's correct name
                const isCorrect = userAnswer.toLowerCase() === job.name.toLowerCase();
                setFeedback(`ex1-feedback-${job.name.replace(/\s/g, '-')}`, isCorrect);

                const selectElement = getElement(`ex1-select-${job.name.replace(/\s/g, '-')}`);
                selectElement.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50', 'border-gray-300');
                if (isCorrect) {
                    selectElement.classList.add('border-green-500', 'bg-green-50');
                } else if (userAnswer) {
                    selectElement.classList.add('border-red-500', 'bg-red-50');
                } else {
                    selectElement.classList.add('border-gray-300');
                }
            });
        }

        function initializeExercise2() {
            const textareaElement = getElement('ex2-user-corrections');
            textareaElement.addEventListener('input', (event) => {
                appState.exercise2UserCorrections = event.target.value;
                saveAnswers();
            });
            getElement('check-ex2-button').addEventListener('click', checkExercise2);
        }

        function checkExercise2() {
            let correctCount = 0;
            let feedbackText = '';
            const userText = appState.exercise2UserCorrections.trim();
            const feedbackElement = getElement('ex2-feedback');

            if (!userText) {
                feedbackElement.classList.remove('hidden', 'correct', 'incorrect');
                feedbackElement.classList.add('incorrect');
                feedbackElement.textContent = 'Please type your corrected text to check for mistakes.';
                return;
            }

            let allCorrectionsFound = true;
            exercise2ExpectedCorrections.forEach(mistake => {
                if (userText.includes(mistake.corrected)) {
                    correctCount++;
                } else {
                    allCorrectionsFound = false;
                    feedbackText += `\nMissing correction for: "${mistake.original}" (should be "${mistake.corrected}")`;
                }
            });

            feedbackElement.classList.remove('hidden', 'correct', 'incorrect');
            if (allCorrectionsFound && correctCount === exercise2ExpectedCorrections.length) {
                feedbackElement.classList.add('correct');
                feedbackElement.textContent = 'Great job! You found and corrected all the mistakes.';
            } else {
                feedbackElement.classList.add('incorrect');
                feedbackElement.textContent = `You corrected ${correctCount} out of ${exercise2ExpectedCorrections.length} mistakes. ${feedbackText}`;
            }
        }

        function initializeExercise3() {
            const container = getElement('exercise3-container');
            exercise3Sentences.forEach((sentence, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = "flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-2 p-3 border border-green-200 rounded-md bg-white";

                const parts = sentence.text.split('________');
                const sentenceFragment1 = document.createElement('span');
                sentenceFragment1.textContent = parts[0];
                itemDiv.appendChild(sentenceFragment1);

                const input = document.createElement('input');
                input.type = "text";
                input.id = `ex3-input-${index}`;
                input.className = "p-2 border rounded-md focus:ring-green-500 focus:border-green-500 max-w-xs md:max-w-none flex-grow";
                input.placeholder = "Type verb form";
                input.addEventListener('input', (event) => {
                    appState.exercise3Answers[index] = event.target.value.trim();
                    saveAnswers();
                });
                itemDiv.appendChild(input);

                if (parts[1]) {
                    const sentenceFragment2 = document.createElement('span');
                    sentenceFragment2.textContent = parts[1];
                    itemDiv.appendChild(sentenceFragment2);
                }

                const feedbackSpan = document.createElement('span');
                feedbackSpan.id = `ex3-feedback-${index}`;
                feedbackSpan.className = "hidden";
                itemDiv.appendChild(feedbackSpan);

                container.appendChild(itemDiv);
            });
            getElement('check-ex3-button').addEventListener('click', checkExercise3);
        }

        function checkExercise3() {
            exercise3Sentences.forEach((sentence, index) => {
                const userAnswer = appState.exercise3Answers[index] || '';
                const isCorrect = userAnswer.toLowerCase() === sentence.correct.toLowerCase();
                setFeedback(`ex3-feedback-${index}`, isCorrect);

                const inputElement = getElement(`ex3-input-${index}`);
                inputElement.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50', 'border-gray-300');
                if (isCorrect) {
                    inputElement.classList.add('border-green-500', 'bg-green-50');
                } else if (userAnswer) {
                    inputElement.classList.add('border-red-500', 'bg-red-50');
                } else {
                    inputElement.classList.add('border-gray-300');
                }
            });
        }

        function initializeExercise4() {
            const container = getElement('exercise4-container');
            exercise4Questions.forEach((q, qIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = "mb-4 p-4 border border-purple-200 rounded-md bg-purple-100";
                questionDiv.innerHTML = `<p class="mb-3">${q.text}</p>`;

                const blanksContainer = document.createElement('div');
                blanksContainer.className = "flex flex-wrap gap-4"; // Use flex wrap for multiple blanks

                q.blanks.forEach((blank, bIndex) => {
                    const blankWrapper = document.createElement('div');
                    blankWrapper.className = "flex flex-col space-y-2"; // Wrapper for each blank's radio buttons

                    blank.options.forEach(option => {
                        const label = document.createElement('label');
                        label.className = "inline-flex items-center cursor-pointer";
                        const input = document.createElement('input');
                        input.type = "radio";
                        input.name = `ex4-q${qIndex}b${bIndex}`;
                        // Create a safe ID for the option value by replacing non-alphanumeric chars
                        input.id = `ex4-q${qIndex}b${bIndex}-${option.replace(/[^a-zA-Z0-9]/g, 'dash')}`;
                        input.value = option;
                        input.className = "form-radio h-5 w-5 text-purple-600 focus:ring-purple-500";
                        input.addEventListener('change', (event) => {
                            appState.exercise4Answers[`q${qIndex}b${bIndex}`] = event.target.value;
                            saveAnswers();
                        });
                        label.appendChild(input);
                        const span = document.createElement('span');
                        span.className = "ml-2 text-gray-700";
                        span.textContent = option;
                        label.appendChild(span);
                        blankWrapper.appendChild(label);
                    });
                    blanksContainer.appendChild(blankWrapper);
                });
                questionDiv.appendChild(blanksContainer);

                const feedbackDiv = document.createElement('div');
                feedbackDiv.id = `ex4-feedback-q${qIndex}`;
                feedbackDiv.className = "hidden feedback-box mt-3";
                questionDiv.appendChild(feedbackDiv);

                container.appendChild(questionDiv);
            });
            getElement('check-ex4-button').addEventListener('click', checkExercise4);
        }

        function checkExercise4() {
            exercise4Questions.forEach((q, qIndex) => {
                let allCorrectForQuestion = true;
                q.blanks.forEach((blank, bIndex) => {
                    const userAnswer = appState.exercise4Answers[`q${qIndex}b${bIndex}`] || '';
                    const isCorrect = userAnswer === blank.correct;
                    if (!isCorrect) {
                        allCorrectForQuestion = false;
                    }
                    // Apply immediate feedback to the radio buttons themselves
                    const radioGroup = document.querySelectorAll(`input[name="ex4-q${qIndex}b${bIndex}"]`);
                    radioGroup.forEach(radio => {
                        const label = radio.parentElement; // Get the parent label
                        label.classList.remove('text-green-700', 'text-red-700', 'font-semibold');
                        if (radio.value === blank.correct) {
                            label.classList.add('font-semibold'); // Highlight correct option
                            if (userAnswer && radio.value === userAnswer) { // User selected the correct one
                                label.classList.add('text-green-700');
                            }
                        } else if (radio.value === userAnswer && !isCorrect) { // User selected incorrect option
                            label.classList.add('text-red-700');
                        }
                    });
                });

                const feedbackElement = getElement(`ex4-feedback-q${qIndex}`);
                feedbackElement.classList.remove('hidden', 'correct', 'incorrect');
                if (allCorrectForQuestion) {
                    feedbackElement.classList.add('correct');
                    feedbackElement.textContent = 'Correct!';
                } else {
                    feedbackElement.classList.add('incorrect');
                    feedbackElement.textContent = 'Incorrect. Review your selections.';
                }
            });
        }

        function initializeExercise5() {
            const container = getElement('exercise5-container');
            exercise5Sentences.forEach((sentence, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = "flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-2 p-3 border border-yellow-200 rounded-md bg-white";

                const parts = sentence.text.split('_______'); // Split by blank
                const sentenceFragment1 = document.createElement('span');
                sentenceFragment1.textContent = parts[0];
                itemDiv.appendChild(sentenceFragment1);

                const select = document.createElement('select');
                select.id = `ex5-select-${index}`;
                select.className = "p-2 border rounded-md focus:ring-yellow-500 focus:border-yellow-500 max-w-xs md:max-w-none";

                const defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = "---";
                select.appendChild(defaultOption);

                exercise5Options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    select.appendChild(opt);
                });
                select.addEventListener('change', (event) => {
                    appState.exercise5Answers[index] = event.target.value;
                    saveAnswers();
                });
                itemDiv.appendChild(select);

                if (parts[1]) {
                    const sentenceFragment2 = document.createElement('span');
                    sentenceFragment2.textContent = parts[1];
                    itemDiv.appendChild(sentenceFragment2);
                }

                const feedbackSpan = document.createElement('span');
                feedbackSpan.id = `ex5-feedback-${index}`;
                feedbackSpan.className = "hidden";
                itemDiv.appendChild(feedbackSpan);

                container.appendChild(itemDiv);
            });
            getElement('check-ex5-button').addEventListener('click', checkExercise5);
        }

        function checkExercise5() {
            exercise5Sentences.forEach((sentence, index) => {
                const userAnswer = appState.exercise5Answers[index] || '';
                const isCorrect = userAnswer.toLowerCase() === sentence.correct.toLowerCase();
                setFeedback(`ex5-feedback-${index}`, isCorrect);

                const selectElement = getElement(`ex5-select-${index}`);
                selectElement.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50', 'border-gray-300');
                if (isCorrect) {
                    selectElement.classList.add('border-green-500', 'bg-green-50');
                } else if (userAnswer) {
                    selectElement.classList.add('border-red-500', 'bg-red-50');
                } else {
                    selectElement.classList.add('border-gray-300');
                }
            });
        }

        function initializeExercise6() {
            const container = getElement('exercise6-container');
            exercise6Matches.forEach((match, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = "flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-4 p-3 border border-red-200 rounded-md bg-white";

                const sentencePara = document.createElement('p');
                sentencePara.className = "flex-grow text-gray-700 font-mono";
                sentencePara.textContent = match.sentence;
                itemDiv.appendChild(sentencePara);

                const select = document.createElement('select');
                select.id = `ex6-select-${index}`;
                select.className = "p-2 border rounded-md flex-shrink-0 md:w-64 focus:ring-red-500 focus:border-red-500";

                const defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = "Select a matching phrase";
                select.appendChild(defaultOption);

                exercise6Phrases.forEach(phrase => {
                    const option = document.createElement('option');
                    option.value = phrase;
                    option.textContent = phrase;
                    select.appendChild(option);
                });
                select.addEventListener('change', (event) => {
                    appState.exercise6Answers[index] = event.target.value;
                    saveAnswers();
                });
                itemDiv.appendChild(select);

                const feedbackSpan = document.createElement('span');
                feedbackSpan.id = `ex6-feedback-${index}`;
                feedbackSpan.className = "hidden";
                itemDiv.appendChild(feedbackSpan);

                container.appendChild(itemDiv);
            });
            getElement('check-ex6-button').addEventListener('click', checkExercise6);
        }

        function checkExercise6() {
            exercise6Matches.forEach((match, index) => {
                const userAnswer = appState.exercise6Answers[index] || '';
                const isCorrect = userAnswer === match.correctPhrase;
                setFeedback(`ex6-feedback-${index}`, isCorrect);

                const selectElement = getElement(`ex6-select-${index}`);
                selectElement.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50', 'border-gray-300');
                if (isCorrect) {
                    selectElement.classList.add('border-green-500', 'bg-green-50');
                } else if (userAnswer) {
                    selectElement.classList.add('border-red-500', 'bg-red-50');
                } else {
                    selectElement.classList.add('border-gray-300');
                }
            });
        }

        function initializeExercise7() {
            const container = getElement('exercise7-container');
            exercise7Sentences.forEach((sentence, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = "flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-4 p-3 border border-teal-200 rounded-md bg-white";

                const select = document.createElement('select');
                select.id = `ex7-select-${index}`;
                select.className = "p-2 border rounded-md flex-shrink-0 md:w-64 focus:ring-teal-500 focus:border-teal-500";

                const defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = "Select a phrase";
                select.appendChild(defaultOption);

                exercise7Phrases.forEach(phrase => {
                    const option = document.createElement('option');
                    option.value = phrase;
                    option.textContent = phrase;
                    select.appendChild(option);
                });
                select.addEventListener('change', (event) => {
                    appState.exercise7Answers[index] = event.target.value;
                    saveAnswers();
                });
                itemDiv.appendChild(select);

                const sentencePara = document.createElement('p');
                sentencePara.className = "flex-grow text-gray-700";
                sentencePara.textContent = sentence.text.replace(/_____\s/, ''); // Remove the blank placeholder
                itemDiv.appendChild(sentencePara);

                const feedbackSpan = document.createElement('span');
                feedbackSpan.id = `ex7-feedback-${index}`;
                feedbackSpan.className = "hidden";
                itemDiv.appendChild(feedbackSpan);

                container.appendChild(itemDiv);
            });
            getElement('check-ex7-button').addEventListener('click', checkExercise7);
        }

        function checkExercise7() {
            exercise7Sentences.forEach((sentence, index) => {
                const userAnswer = appState.exercise7Answers[index] || '';
                const isCorrect = userAnswer === sentence.correct;
                setFeedback(`ex7-feedback-${index}`, isCorrect);

                const selectElement = getElement(`ex7-select-${index}`);
                selectElement.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50', 'border-gray-300');
                if (isCorrect) {
                    selectElement.classList.add('border-green-500', 'bg-green-50');
                } else if (userAnswer) {
                    selectElement.classList.add('border-red-500', 'bg-red-50');
                } else {
                    selectElement.classList.add('border-gray-300');
                }
            });
        }

        function initializeExercise8() {
            const container = getElement('exercise8-container');
            exercise8ScrambledSentences.forEach((sentence, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = "flex flex-col space-y-2 p-3 border border-orange-200 rounded-md bg-white";

                const scrambledWordsDiv = document.createElement('div');
                scrambledWordsDiv.className = "font-mono text-gray-600 text-sm mb-2";
                scrambledWordsDiv.textContent = `Scrambled: ${sentence.scrambled.join(' ')}`;
                itemDiv.appendChild(scrambledWordsDiv);

                const input = document.createElement('input');
                input.type = "text";
                input.id = `ex8-input-${index}`;
                input.className = "p-2 border rounded-md focus:ring-orange-500 focus:border-orange-500 w-full";
                input.placeholder = "Type the correct sentence here...";
                input.addEventListener('input', (event) => {
                    appState.exercise8Answers[index] = event.target.value.trim();
                    saveAnswers();
                });
                itemDiv.appendChild(input);

                const feedbackSpan = document.createElement('span');
                feedbackSpan.id = `ex8-feedback-${index}`;
                feedbackSpan.className = "hidden mt-2";
                itemDiv.appendChild(feedbackSpan); /* Fixed: Changed 'feedback कोशिका' to 'feedbackSpan' */

                container.appendChild(itemDiv);
            });
            getElement('check-ex8-button').addEventListener('click', checkExercise8);
        }

        function checkExercise8() {
            exercise8ScrambledSentences.forEach((sentence, index) => {
                const userAnswer = appState.exercise8Answers[index] || '';
                // Basic check: remove punctuation and compare lowercase words
                const normalize = (text) => text.toLowerCase().replace(/[.,!?;:]/g, '').replace(/\s+/g, ' ').trim();

                const isCorrect = normalize(userAnswer) === normalize(sentence.correct);
                setFeedback(`ex8-feedback-${index}`, isCorrect);

                const inputElement = getElement(`ex8-input-${index}`);
                inputElement.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50', 'border-gray-300');
                if (isCorrect) {
                    inputElement.classList.add('border-green-500', 'bg-green-50');
                } else if (userAnswer) {
                    inputElement.classList.add('border-red-500', 'bg-red-50');
                } else {
                    inputElement.classList.add('border-gray-300');
                }
            });
        }

        function initializeExercise9() {
            const container = getElement('exercise9-container');
            exercise9Questions.forEach((q, qIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = "mb-4 p-4 border border-pink-200 rounded-md bg-pink-100";
                questionDiv.innerHTML = `<p class="font-semibold mb-3">${q.question}</p>`;

                q.options.forEach((optionText, oIndex) => {
                    const label = document.createElement('label');
                    label.className = "inline-flex items-center cursor-pointer mb-2";

                    const input = document.createElement('input');
                    input.type = "radio";
                    input.name = `ex9-q${qIndex}`;
                    // Create a safe ID for the option value
                    const safeOptionId = optionText.replace(/[^a-zA-Z0-9]/g, '');
                    input.id = `ex9-q${qIndex}-option-${safeOptionId}`;
                    input.value = optionText;
                    input.className = "form-radio h-5 w-5 text-pink-600 focus:ring-pink-500";
                    input.addEventListener('change', (event) => {
                        appState.exercise9Answers[qIndex] = event.target.value;
                        saveAnswers();
                    });
                    label.appendChild(input);

                    const span = document.createElement('span');
                    span.className = "ml-2 text-gray-700";
                    span.textContent = optionText;
                    label.appendChild(span);

                    questionDiv.appendChild(label);
                });

                const feedbackDiv = document.createElement('div');
                feedbackDiv.id = `ex9-feedback-q${qIndex}`;
                feedbackDiv.className = "hidden feedback-box mt-3";
                questionDiv.appendChild(feedbackDiv);

                container.appendChild(questionDiv);
            });
            getElement('check-ex9-button').addEventListener('click', checkExercise9);
        }

        function checkExercise9() {
            exercise9Questions.forEach((q, qIndex) => {
                const userAnswer = appState.exercise9Answers[qIndex] || '';
                const isCorrect = userAnswer === q.correct;

                const feedbackElement = getElement(`ex9-feedback-q${qIndex}`);
                feedbackElement.classList.remove('hidden', 'correct', 'incorrect');
                if (isCorrect) {
                    feedbackElement.classList.add('correct');
                    feedbackElement.textContent = 'Correct!';
                } else {
                    feedbackElement.classList.add('incorrect');
                    feedbackElement.textContent = 'Incorrect. Review your selection.';
                }

                // Update styling for radio buttons
                document.querySelectorAll(`input[name="ex9-q${qIndex}"]`).forEach(radio => {
                    const label = radio.parentElement;
                    label.classList.remove('text-green-700', 'text-red-700', 'font-semibold');
                    if (radio.value === q.correct) {
                        label.classList.add('font-semibold'); // Highlight correct option
                        if (userAnswer && radio.value === userAnswer) { // User selected the correct one
                            label.classList.add('text-green-700');
                        }
                    } else if (radio.value === userAnswer && !isCorrect) { // User selected incorrect option
                        label.classList.add('text-red-700');
                    }
                });
            });
        }

        function initializeExercise10() {
            const textarea = getElement('ex10-text');
            const wordCountSpan = getElement('ex10-word-count');

            textarea.addEventListener('input', (event) => {
                appState.exercise10Text = event.target.value;
                const words = event.target.value.split(/\s+/).filter(word => word.length > 0).length;
                wordCountSpan.textContent = words;
                saveAnswers();
            });
        }

        function clearAllAnswers() {
            // Clear Exercise 1 dropdowns and feedback
            exercise1Jobs.forEach(job => {
                const select = getElement(`ex1-select-${job.name.replace(/\s/g, '-')}`);
                if (select) {
                    select.value = "";
                    select.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                    select.classList.add('border-gray-300');
                }
                appState.exercise1Answers[job.name] = '';
                clearFeedback(`ex1-feedback-${job.name.replace(/\s/g, '-')}`);
            });

            // Clear Exercise 2 textarea and feedback
            const ex2Textarea = getElement('ex2-user-corrections');
            if (ex2Textarea) ex2Textarea.value = '';
            appState.exercise2UserCorrections = '';
            const ex2FeedbackDiv = getElement('ex2-feedback');
            if (ex2FeedbackDiv) {
                ex2FeedbackDiv.classList.add('hidden');
                ex2FeedbackDiv.classList.remove('correct', 'incorrect');
                ex2FeedbackDiv.textContent = '';
            }

            // Clear Exercise 3 inputs and feedback
            exercise3Sentences.forEach((sentence, index) => {
                const input = getElement(`ex3-input-${index}`);
                if (input) {
                    input.value = "";
                    input.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                    input.classList.add('border-gray-300');
                }
                appState.exercise3Answers[index] = '';
                clearFeedback(`ex3-feedback-${index}`);
            });

            // Clear Exercise 4 radio buttons and feedback
            exercise4Questions.forEach((q, qIndex) => {
                q.blanks.forEach((blank, bIndex) => {
                    document.querySelectorAll(`input[name="ex4-q${qIndex}b${bIndex}"]`).forEach(radio => {
                        radio.checked = false;
                        radio.parentElement.classList.remove('text-green-700', 'text-red-700', 'font-semibold');
                    });
                });
                const feedbackDiv = getElement(`ex4-feedback-q${qIndex}`);
                if (feedbackDiv) {
                    feedbackDiv.classList.add('hidden');
                    feedbackDiv.classList.remove('correct', 'incorrect');
                    feedbackDiv.textContent = '';
                }
                appState.exercise4Answers[`q${qIndex}b${bIndex}`] = '';
            });

            // Clear Exercise 5 dropdowns and feedback
            exercise5Sentences.forEach((sentence, index) => {
                const select = getElement(`ex5-select-${index}`);
                if (select) {
                    select.value = "";
                    select.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                    select.classList.add('border-gray-300');
                }
                appState.exercise5Answers[index] = '';
                clearFeedback(`ex5-feedback-${index}`);
            });

            // Clear Exercise 6 dropdowns and feedback
            exercise6Matches.forEach((match, index) => {
                const select = getElement(`ex6-select-${index}`);
                if (select) {
                    select.value = "";
                    select.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                    select.classList.add('border-gray-300');
                }
                appState.exercise6Answers[index] = '';
                clearFeedback(`ex6-feedback-${index}`);
            });

            // Clear Exercise 7 dropdowns and feedback
            exercise7Sentences.forEach((sentence, index) => {
                const select = getElement(`ex7-select-${index}`);
                if (select) {
                    select.value = "";
                    select.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                    select.classList.add('border-gray-300');
                }
                appState.exercise7Answers[index] = '';
                clearFeedback(`ex7-feedback-${index}`);
            });

            // Clear Exercise 8 inputs and feedback
            exercise8ScrambledSentences.forEach((sentence, index) => {
                const input = getElement(`ex8-input-${index}`);
                if (input) {
                    input.value = "";
                    input.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                    input.classList.add('border-gray-300');
                }
                appState.exercise8Answers[index] = '';
                clearFeedback(`ex8-feedback-${index}`);
            });

            // Clear Exercise 9 radio buttons and feedback
            exercise9Questions.forEach((q, qIndex) => {
                document.querySelectorAll(`input[name="ex9-q${qIndex}"]`).forEach(radio => {
                    radio.checked = false;
                    radio.parentElement.classList.remove('text-green-700', 'text-red-700', 'font-semibold');
                });
                const feedbackDiv = getElement(`ex9-feedback-q${qIndex}`);
                if (feedbackDiv) {
                    feedbackDiv.classList.add('hidden');
                    feedbackDiv.classList.remove('correct', 'incorrect');
                    feedbackDiv.textContent = '';
                }
                appState.exercise9Answers[qIndex] = '';
            });


            // Clear Exercise 10 textarea
            const ex10Textarea = getElement('ex10-text');
            if (ex10Textarea) ex10Textarea.value = '';
            appState.exercise10Text = '';
            const ex10WordCount = getElement('ex10-word-count');
            if (ex10WordCount) ex10WordCount.textContent = '0';

            saveAnswers(); // Save the cleared state
        }


        // --- Initialize all exercises on window load ---
        window.onload = function() {
            initializeExercise1();
            initializeExercise2();
            initializeExercise3();
            initializeExercise4();
            initializeExercise5();
            initializeExercise6();
            initializeExercise7();
            initializeExercise8();
            initializeExercise9();
            initializeExercise10();

            // Attach event listener for clear all answers
            getElement('clear-all-answers-button').addEventListener('click', clearAllAnswers);
            
            // Load saved answers on page load
            loadAnswers();
        };
    </script>
</body>
</html>
