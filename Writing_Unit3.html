<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindset for IELTS 1 - Unit 3 Writing</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #334155;
        }
        .container {
            max-width: 960px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .exercise-section {
            margin-bottom: 2.5rem;
            padding: 1.5rem;
            background-color: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        .exercise-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1.25rem;
            border-bottom: 2px solid #cbd5e1;
            padding-bottom: 0.75rem;
        }
        .question-text {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        .input-field, .select-field, .textarea-field {
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .input-field:focus, .select-field:focus, .textarea-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        .feedback-message {
            margin-top: 0.75rem;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            display: none; /* Hidden by default */
        }
        .feedback-message.correct {
            background-color: #d1fae5;
            color: #065f46;
        }
        .feedback-message.incorrect {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .check-button {
            background-color: #3b82f6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .check-button:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }
        .check-button:active {
            background-color: #1d4ed8;
            transform: translateY(0);
        }
        .image-container {
            margin-top: 1rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .drag-item {
            background-color: #e0f2fe;
            border: 1px solid #90cdf4;
            padding: 0.5rem 1rem;
            margin: 0.5rem;
            border-radius: 6px;
            cursor: grab;
            display: inline-block;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s;
        }
        .drag-item:hover {
            background-color: #bfdbfe;
        }
        .drop-target {
            border: 2px dashed #9ca3af;
            padding: 0.75rem;
            margin: 0.5rem 0;
            min-height: 40px;
            border-radius: 6px;
            background-color: #f9fafb;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
        }
        .drop-target.hover {
            background-color: #e0f2fe;
            border-color: #3b82f6;
        }
        .drop-target.filled {
            border-color: #10b981;
            background-color: #d1fae5;
            color: #065f46;
        }
        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: #f0f9ff;
            border-radius: 8px;
            border: 1px solid #bae6fd;
        }
        .order-container {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.5rem;
            min-height: 60px;
            border: 2px dashed #a78bfa;
            border-radius: 8px;
            padding: 0.75rem;
            background-color: #f3e8ff;
        }
        .order-item {
            background-color: #c4b5fd;
            color: #4c1d95;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            cursor: grab;
            font-weight: 500;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .order-item.dragging {
            opacity: 0.5;
        }
        .sentence-slot {
            flex-grow: 1;
            min-width: 80px;
            height: 40px;
            border-bottom: 2px solid #9ca3af;
            margin: 0 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            color: #6b7280;
        }
        .sentence-slot.filled {
            border-bottom-color: #3b82f6;
            color: #1e293b;
            font-style: normal;
        }
        .sentence-slot .order-item {
            margin: 0;
        }
        .word-bank-sentence { /* New style for per-sentence word banks */
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background-color: #e6fffa; /* Light teal background */
            border-radius: 8px;
            border: 1px solid #81e6d9; /* Teal border */
        }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Mindset for IELTS 1 - Unit 3 Writing</h1>

        <!-- Exercise 1: Matching descriptions with charts -->
        <div class="exercise-section">
            <h2 class="exercise-title">Unit 3: Exercise 1</h2>
            <p class="question-text">In IELTS Writing Task 1 you might be asked to write a report about a chart or graph.<br>Match the descriptions with the charts and graphs.</p>
            <div class="mb-4">
                <p>This is a pie chart.</p>
                <p>This is a bar chart.</p>
                <p>This is a line graph.</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label for="ex1_q1" class="block text-gray-700 font-medium mb-1">1. (Image 1 - Placeholder for actual image)</label>
                    <input type="text" id="ex1_q1" class="input-field" placeholder="e.g. This is a bar chart.">
                    <div id="feedback_ex1_q1" class="feedback-message"></div>
                </div>
                <div>
                    <label for="ex1_q2" class="block text-gray-700 font-medium mb-1">2. (Image 2 - Placeholder for actual image)</label>
                    <input type="text" id="ex1_q2" class="input-field" placeholder="e.g. This is a pie chart.">
                    <div id="feedback_ex1_q2" class="feedback-message"></div>
                </div>
                <div>
                    <label for="ex1_q3" class="block text-gray-700 font-medium mb-1">3. (Image 3 - Placeholder for actual image)</label>
                    <input type="text" id="ex1_q3" class="input-field" placeholder="e.g. This is a line graph.">
                    <div id="feedback_ex1_q3" class="feedback-message"></div>
                </div>
            </div>
            <button onclick="checkExercise1()" class="check-button mt-6">Check Answers</button>
        </div>

        <!-- Exercise 2: Fill the gaps in the chart below with the correct words. -->
        <div class="exercise-section">
            <h2 class="exercise-title">Unit 3: Exercise 2</h2>
            <p class="question-text">The bar chart compares the amount of money (in millions of dollars) that people in four different age groups from Seoul, South Korea, spent on going to the cinema, restaurants and music concerts in 2014.<br>Fill the gaps in the chart below with the correct words.</p>
            <div class="word-bank">
                <span class="drag-item" draggable="true" data-word="Axis">Axis</span>
                <span class="drag-item" draggable="true" data-word="data">data</span>
                <span class="drag-item" draggable="true" data-word="different age groups">different age groups</span>
                <span class="drag-item" draggable="true" data-word="money spent">money spent</span>
            </div>
            <div class="image-container">
                <img src="https://placehold.co/600x400/E0F2FE/3B82F6" alt="Bar Chart for Exercise 2">
            </div>
            <p class="question-text">Imagine the chart has labels for X and Y axis, and for the data bars. Drag and drop the words to the correct descriptions below.</p>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Horizontal label (e.g., age groups):</label>
                    <div id="ex2_drop1" class="drop-target" data-correct="different age groups">Drag word here</div>
                    <div id="feedback_ex2_q1" class="feedback-message"></div>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Vertical label (e.g., amount of money):</label>
                    <div id="ex2_drop2" class="drop-target" data-correct="money spent">Drag word here</div>
                    <div id="feedback_ex2_q2" class="feedback-message"></div>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-1">The numerical values represented by the bars:</label>
                    <div id="ex2_drop3" class="drop-target" data-correct="data">Drag word here</div>
                    <div id="feedback_ex2_q3" class="feedback-message"></div>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-1">A line used for measurement or reference:</label>
                    <div id="ex2_drop4" class="drop-target" data-correct="Axis">Drag word here</div>
                    <div id="feedback_ex2_q4" class="feedback-message"></div>
                </div>
            </div>
            <button onclick="checkExercise2()" class="check-button mt-6">Check Answers</button>
        </div>

        <!-- Exercise 3: Choose the correct answers to complete the statements. -->
        <div class="exercise-section">
            <h2 class="exercise-title">Unit 3: Exercise 3</h2>
            <p class="question-text">The bar chart compares the amount of money (in millions of dollars) that people in four different age groups from Seoul, South Korea, spent on going to the cinema, restaurants and music concerts in 2014.<br>Choose the correct answers to complete the statements.</p>
            <div class="image-container">
                <img src="https://placehold.co/600x400/E0F2FE/3B82F6" alt="Bar Chart for Exercise 3">
            </div>
            <div class="space-y-4">
                <div>
                    <p class="question-text">The 26–39 age group spent less than the 40–55 age group on going to the:</p>
                    <select id="ex3_q1" class="select-field">
                        <option value="">Select an option</option>
                        <option value="cinema">cinema</option>
                        <option value="restaurants">restaurants</option>
                        <option value="music concerts">music concerts</option>
                    </select>
                    <div id="feedback_ex3_q1" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">The 18–25 age group spent:</p>
                    <select id="ex3_q2" class="select-field">
                        <option value="">Select an option</option>
                        <option value="less than the 26–39 age group">less than the 26–39 age group</option>
                        <option value="about $14 million">about $14 million</option>
                        <option value="the same as the 56–80 age group">the same as the 56–80 age group</option>
                    </select>
                    <span class="font-medium">on going to music concerts.</span>
                    <div id="feedback_ex3_q2" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">The 56–80 age group spent the least of their money on going to:</p>
                    <select id="ex3_q3" class="select-field">
                        <option value="">Select an option</option>
                        <option value="the cinema">the cinema</option>
                        <option value="restaurants">restaurants</option>
                        <option value="music concerts">music concerts</option>
                    </select>
                    <div id="feedback_ex3_q3" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">The 26–39 age group spent about the same on going to:</p>
                    <select id="ex3_q4" class="select-field">
                        <option value="">Select an option</option>
                        <option value="the cinema and restaurants">the cinema and restaurants</option>
                        <option value="the cinema and music concerts">the cinema and music concerts</option>
                        <option value="restaurants and music concerts">restaurants and music concerts</option>
                    </select>
                    <div id="feedback_ex3_q4" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">The 40–55 age group spent:</p>
                    <select id="ex3_q5" class="select-field">
                        <option value="">Select an option</option>
                        <option value="about $10 million">about $10 million</option>
                        <option value="over $20 million">over $20 million</option>
                        <option value="under $5 million">under $5 million</option>
                    </select>
                    <span class="font-medium">on going to the cinema.</span>
                    <div id="feedback_ex3_q5" class="feedback-message"></div>
                </div>
            </div>
            <button onclick="checkExercise3()" class="check-button mt-6">Check Answers</button>
        </div>

        <!-- Exercise 4: Match sentences with main features -->
        <div class="exercise-section">
            <h2 class="exercise-title">Unit 3: Exercise 4</h2>
            <p class="question-text">The bar chart compares the amount of money (in millions of dollars) that people in four different age groups from Seoul, South Korea, spent on going to the cinema, restaurants and music concerts in 2014.<br>Read the information. Then read the sentences about the chart and match them with the correct main features. Use the words in the box.</p>
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-4">
                <p class="text-blue-800 italic">"When you write a report on a graph or chart for IELTS Writing Task 1, you should try to describe the main features. This means writing about the most important pieces of information on the graph or chart. The main features could be the highest/lowest numbers, the biggest differences, and any similarities."</p>
            </div>
            <div class="image-container">
                <img src="https://placehold.co/600x400/E0F2FE/3B82F6" alt="Bar Chart for Exercise 4">
            </div>
            <div class="word-bank">
                <span class="drag-item" draggable="true" data-word="a similarity">a similarity</span>
                <span class="drag-item" draggable="true" data-word="a main difference">a main difference</span>
                <span class="drag-item" draggable="true" data-word="important numbers">important numbers</span>
            </div>
            <div class="space-y-4">
                <div>
                    <p class="question-text">The 26–39 age group spent the most money on going to the cinema while the 56–80s spent the least money.</p>
                    <div id="ex4_drop1" class="drop-target" data-correct="a main difference">Drag word here</div>
                    <div id="feedback_ex4_drop1" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">The 40–55 and 56–80 age groups spent almost the same amount of money on music concerts, at about $7 million.</p>
                    <div id="ex4_drop2" class="drop-target" data-correct="a similarity">Drag word here</div>
                    <div id="feedback_ex4_drop2" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">Overall, the most amount of money was spent on going to restaurants (about $67 million), compared with going to the cinema (about $40 million) and music concerts (also about $40 million).</p>
                    <div id="ex4_drop3" class="drop-target" data-correct="important numbers">Drag word here</div>
                    <div id="feedback_ex4_drop3" class="feedback-message"></div>
                </div>
            </div>
            <button onclick="checkExercise4()" class="check-button mt-6">Check Answers</button>
        </div>

        <!-- Exercise 5: Choose the correct words to complete the student’s report. -->
        <div class="exercise-section">
            <h2 class="exercise-title">Unit 3: Exercise 5</h2>
            <p class="question-text">The bar chart compares the amount of money (in millions of dollars) that people in four different age groups from Seoul, South Korea, spent on going to the cinema, restaurants and music concerts in 2014.<br>Choose the correct words to complete the student’s report. Use the words in the box.</p>
            <div class="image-container">
                <img src="https://placehold.co/600x400/E0F2FE/3B82F6" alt="Bar Chart for Exercise 5">
            </div>
            <div class="word-bank">
                <span class="drag-item" draggable="true" data-word="18-25">18-25</span>
                <span class="drag-item" draggable="true" data-word="40-55">40-55</span>
                <span class="drag-item" draggable="true" data-word="amount">amount</span>
                <span class="drag-item" draggable="true" data-word="category">category</span>
                <span class="drag-item" draggable="true" data-word="compared">compared</span>
                <span class="drag-item" draggable="true" data-word="highest">highest</span>
                <span class="drag-item" draggable="true" data-word="money">money</span>
                <span class="drag-item" draggable="true" data-word="Spent">Spent</span>
                <span class="drag-item" draggable="true" data-word="total">total</span>
            </div>
            <div class="space-y-4">
                <p class="question-text">The bar chart shows how much South Koreans of different age groups spent on seeing movies, eating out and going to concerts in 2014.</p>
                <p class="question-text">Overall, the <input type="text" id="ex5_q1" class="input-field inline-block w-32" placeholder="_______"> amount of money was spent on going to restaurants (about $67 million), <input type="text" id="ex5_q2" class="input-field inline-block w-32" placeholder="_______"> with going to the cinema (about $40 million) and music concerts (also about $40 million).</p>
                <div id="feedback_ex5_q1" class="feedback-message"></div> <!-- Added missing feedback div -->
                <div id="feedback_ex5_q2" class="feedback-message"></div> <!-- Added missing feedback div -->

                <p class="question-text">The <input type="text" id="ex5_q3" class="input-field inline-block w-32" placeholder="_______"> age group spent the most on going to restaurants at about $22 million, while the <input type="text" id="ex5_q4" class="input-field inline-block w-32" placeholder="_______"> age group spent the least with only $13 million. With a total <input type="text" id="ex5_q5" class="input-field inline-block w-32" placeholder="_______"> of approximately $12 million, the 26−39 <input type="text" id="ex5_q6" class="input-field inline-block w-32" placeholder="_______"> had the highest spending on going to the cinema while the 56−80s spent the least <input type="text" id="ex5_q7" class="input-field inline-block w-32" placeholder="_______">, at around $8 million.</p>
                <div id="feedback_ex5_q3" class="feedback-message"></div> <!-- Added missing feedback div -->
                <div id="feedback_ex5_q4" class="feedback-message"></div> <!-- Added missing feedback div -->
                <div id="feedback_ex5_q5" class="feedback-message"></div> <!-- Added missing feedback div -->
                <div id="feedback_ex5_q6" class="feedback-message"></div> <!-- Added missing feedback div -->
                <div id="feedback_ex5_q7" class="feedback-message"></div> <!-- Added missing feedback div -->
            </div>
            <button onclick="checkExercise5()" class="check-button mt-6">Check Answers</button>
        </div>

        <!-- Exercise 6: Choose the correct option to complete each statement. -->
        <div class="exercise-section">
            <h2 class="exercise-title">Unit 3: Exercise 6</h2>
            <p class="question-text">The pie charts compare what male and female teenagers from Peru prefer to do in their free time.<br>Look at the two charts. Choose the correct option to complete each statement.</p>
            <div class="image-container flex flex-col md:flex-row justify-center items-center gap-8">
                <img src="https://placehold.co/300x300/E0F2FE/3B82F6" alt="Pie Chart Free time - Boys">
                <img src="https://placehold.co/300x300/E0F2FE/3B82F6" alt="Pie Chart Free time - Girls">
                <div class="text-left text-sm p-4 bg-gray-50 rounded-lg shadow-sm">
                    <p class="font-semibold mb-2">Free time - Boys</p>
                    <ul class="list-disc list-inside">
                        <li>Watching TV: 15%</li>
                        <li>Using the internet: 30%</li>
                        <li>Meeting friends: 20%</li>
                        <li>Playing sport: 25%</li>
                        <li>Reading: 10%</li>
                    </ul>
                    <p class="font-semibold mt-4 mb-2">Free time - Girls</p>
                    <ul class="list-disc list-inside">
                        <li>Watching TV: 20%</li>
                        <li>Using the internet: 25%</li>
                        <li>Meeting friends: 35%</li>
                        <li>Playing sport: 5%</li>
                        <li>Reading: 15%</li>
                    </ul>
                </div>
            </div>
            <div class="space-y-4">
                <div>
                    <p class="question-text">The most popular activities are using the internet for boys and
                        <select id="ex6_q1" class="select-field inline-block w-auto">
                            <option value="">Select an option</option>
                            <option value="meeting friends">meeting friends</option>
                            <option value="playing sport">playing sport</option>
                            <option value="reading">reading</option>
                            <option value="using the internet">using the internet</option>
                            <option value="watching TV">watching TV</option>
                        </select>
                        for girls.
                    </p>
                    <div id="feedback_ex6_q1" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">The least popular activities are
                        <select id="ex6_q2" class="select-field inline-block w-auto">
                            <option value="">Select an option</option>
                            <option value="meeting friends">meeting friends</option>
                            <option value="playing sport">playing sport</option>
                            <option value="reading">reading</option>
                            <option value="using the internet">using the internet</option>
                            <option value="watching TV">watching TV</option>
                        </select>
                        for boys and playing sport for girls.
                    </p>
                    <div id="feedback_ex6_q2" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">Girls and boys in Peru liked
                        <select id="ex6_q3" class="select-field inline-block w-auto">
                            <option value="">Select an option</option>
                            <option value="meeting friends">meeting friends</option>
                            <option value="playing sport">playing sport</option>
                            <option value="reading">reading</option>
                            <option value="using the internet">using the internet</option>
                            <option value="watching TV">watching TV</option>
                        </select>
                        about the same with 20% for girls and 5% less for boys.
                    </p>
                    <div id="feedback_ex6_q3" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">The biggest difference was playing sport:
                        <select id="ex6_q4" class="select-field inline-block w-auto">
                            <option value="">Select an option</option>
                            <option value="20% fewer">20% fewer</option>
                            <option value="35% fewer">35% fewer</option>
                        </select>
                        girls preferred playing sport than boys.
                    </p>
                    <div id="feedback_ex6_q4" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">Girls liked
                        <select id="ex6_q5" class="select-field inline-block w-auto">
                            <option value="">Select an option</option>
                            <option value="meeting friends">meeting friends</option>
                            <option value="playing sport">playing sport</option>
                            <option value="reading">reading</option>
                            <option value="using the internet">using the internet</option>
                            <option value="watching TV">watching TV</option>
                        </select>
                        15% more than boys.
                    </p>
                    <div id="feedback_ex6_q5" class="feedback-message"></div>
                </div>
            </div>
            <button onclick="checkExercise6()" class="check-button mt-6">Check Answers</button>
        </div>

        <!-- Exercise 7: Complete the statements. -->
        <div class="exercise-section">
            <h2 class="exercise-title">Unit 3: Exercise 7</h2>
            <p class="question-text">Some words or phrases can help you compare or add information in IELTS Writing Task 1.<br>Look at the charts. Then read the student’s report and look at the words in bold. Complete the statements.</p>
            <div class="image-container flex flex-col md:flex-row justify-center items-center gap-8">
                <img src="https://placehold.co/300x300/E0F2FE/3B82F6" alt="Pie Chart Free time - Boys">
                <img src="https://placehold.co/300x300/E0F2FE/3B82F6" alt="Pie Chart Free time - Girls">
                <div class="text-left text-sm p-4 bg-gray-50 rounded-lg shadow-sm">
                    <p class="font-semibold mb-2">Free time - Boys</p>
                    <ul class="list-disc list-inside">
                        <li>Watching TV: 15%</li>
                        <li>Using the internet: 30%</li>
                        <li>Meeting friends: 20%</li>
                        <li>Playing sport: 25%</li>
                        <li>Reading: 10%</li>
                    </ul>
                    <p class="font-semibold mt-4 mb-2">Free time - Girls</p>
                    <ul class="list-disc list-inside">
                        <li>Watching TV: 20%</li>
                        <li>Using the internet: 25%</li>
                        <li>Meeting friends: 35%</li>
                        <li>Playing sport: 5%</li>
                        <li>Reading: 15%</li>
                    </ul>
                </div>
            </div>
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-4">
                <p class="text-blue-800 italic">It is clear that the most popular activity for boys was using the internet <b>while</b> for girls it was meeting friends. <b>By contrast</b>, the least favourite activity for boys was reading with only 10%. <b>Similarly</b>, the least favourite activity for girls was playing sport, <b>also</b> with a low percentage of 5%.<br>Using the internet was the favourite hobby for just under a third of boys <b>whereas</b> meeting friends was the favourite for more than a third of girls. Reading was not very popular with either boys or girls. 10% of the boys preferred to read and only 5% more of the girls.<br>Girls and boys in Peru liked watching TV about the same. 20% of girls preferred watching TV and, <b>in the same way</b>, 15% of boys. The biggest difference was playing sport. 20% fewer girls than boys preferred it.</p>
            </div>
            <div class="space-y-4">
                <p class="question-text">Words and phrases used for comparing information:</p>
                <p class="question-text">... while ... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ... <input type="text" id="ex7_q1" class="input-field inline-block w-32" placeholder="_______"> ... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;By <input type="text" id="ex7_q2" class="input-field inline-block w-32" placeholder="_______"> , ... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ... but ... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; However, ...</p>
                <div id="feedback_ex7_q1" class="feedback-message"></div> <!-- Added missing feedback div -->
                <div id="feedback_ex7_q2" class="feedback-message"></div> <!-- Added missing feedback div -->
                <p class="question-text">Words or phrases used for adding information:</p>
                <p class="question-text"><input type="text" id="ex7_q3" class="input-field inline-block w-32" placeholder="_______"> , ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp; also ... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;... in the <input type="text" id="ex7_q4" class="input-field inline-block w-32" placeholder="_______"> way, ... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ... and&nbsp;...</p>
                <div id="feedback_ex7_q3" class="feedback-message"></div> <!-- Added missing feedback div -->
                <div id="feedback_ex7_q4" class="feedback-message"></div> <!-- Added missing feedback div -->
            </div>
            <button onclick="checkExercise7()" class="check-button mt-6">Check Answers</button>
        </div>

        <!-- Exercise 8: Complete the sentences with the words in the box. -->
        <div class="exercise-section">
            <h2 class="exercise-title">Unit 3: Exercise 8</h2>
            <p class="question-text">Complete the sentences with the words in the box.</p>
            <div class="word-bank">
                <span class="drag-item" draggable="true" data-word="By contrast, Heart of Darkness is very short.">By contrast, Heart of Darkness is very short.</span>
                <span class="drag-item" draggable="true" data-word="By contrast, my sister always eats in restaurants.">By contrast, my sister always eats in restaurants.</span>
                <span class="drag-item" draggable="true" data-word="In the same way, about 65% of singers can read it.">In the same way, about 65% of singers can read it.</span>
                <span class="drag-item" draggable="true" data-word="Similarly, my grandfather also skis every year.">Similarly, my grandfather also skis every year.</span>
                <span class="drag-item" draggable="true" data-word="whereas all the adults cried.">whereas all the adults cried.</span>
                <span class="drag-item" draggable="true" data-word="whereas the worst thing is that it’s expensive.">whereas the worst thing is that it’s expensive.</span>
                <span class="drag-item" draggable="true" data-word="while 65% voted against.">while 65% voted against.</span>
                <span class="drag-item" draggable="true" data-word="while my least favourite are romantic comedies.">while my least favourite are romantic comedies.</span>
            </div>
            <div class="space-y-4">
                <div>
                    <p class="question-text">45% of yoga teachers voted in support <div id="ex8_drop1" class="drop-target inline-block w-full" data-correct="while 65% voted against.">Drag word here</div></p>
                    <div id="feedback_ex8_drop1" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">My brother loves cooking. <div id="ex8_drop2" class="drop-target inline-block w-full" data-correct="By contrast, my sister always eats in restaurants.">Drag word here</div></p>
                    <div id="feedback_ex8_drop2" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">The best thing about horse riding is that it’s fun <div id="ex8_drop3" class="drop-target inline-block w-full" data-correct="whereas the worst thing is that it’s expensive.">Drag word here</div></p>
                    <div id="feedback_ex8_drop3" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">My mother loves skiing. <div id="ex8_drop4" class="drop-target inline-block w-full" data-correct="Similarly, my grandfather also skis every year.">Drag word here</div></p>
                    <div id="feedback_ex8_drop4" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">Two thirds of guitar players can read music. <div id="ex8_drop5" class="drop-target inline-block w-full" data-correct="In the same way, about 65% of singers can read it.">Drag word here</div></p>
                    <div id="feedback_ex8_drop5" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">My favourite movies are action films <div id="ex8_drop6" class="drop-target inline-block w-full" data-correct="while my least favourite are romantic comedies.">Drag word here</div></p>
                    <div id="feedback_ex8_drop6" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">All the children laughed <div id="ex8_drop7" class="drop-target inline-block w-full" data-correct="whereas all the adults cried.">Drag word here</div></p>
                    <div id="feedback_ex8_drop7" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text">War and Peace is a very long book. <div id="ex8_drop8" class="drop-target inline-block w-full" data-correct="By contrast, Heart of Darkness is very short.">Drag word here</div></p>
                    <div id="feedback_ex8_drop8" class="feedback-message"></div>
                </div>
            </div>
            <button onclick="checkExercise8()" class="check-button mt-6">Check Answers</button>
        </div>

        <!-- Exercise 9: Put the words in the correct order to complete the sentences. -->
        <div class="exercise-section">
            <h2 class="exercise-title">Unit 3: Exercise 9</h2>
            <p class="question-text">Put the words in the correct order to complete the sentences.</p>
            <div class="space-y-6">
                <div>
                    <p class="question-text mb-2">Sentence 1:</p>
                    <div id="ex9_word_bank_s1" class="word-bank-sentence"></div>
                    <div id="ex9_order1" class="order-container"></div>
                    <div id="feedback_ex9_q1" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text mb-2">Sentence 2:</p>
                    <div id="ex9_word_bank_s2" class="word-bank-sentence"></div>
                    <div id="ex9_order2" class="order-container"></div>
                    <div id="feedback_ex9_q2" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text mb-2">Sentence 3:</p>
                    <div id="ex9_word_bank_s3" class="word-bank-sentence"></div>
                    <div id="ex9_order3" class="order-container"></div>
                    <div id="feedback_ex9_q3" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text mb-2">Sentence 4:</p>
                    <div id="ex9_word_bank_s4" class="word-bank-sentence"></div>
                    <div id="ex9_order4" class="order-container"></div>
                    <div id="feedback_ex9_q4" class="feedback-message"></div>
                </div>
                <div>
                    <p class="question-text mb-2">Sentence 5:</p>
                    <div id="ex9_word_bank_s5" class="word-bank-sentence"></div>
                    <div id="ex9_order5" class="order-container"></div>
                    <div id="feedback_ex9_q5" class="feedback-message"></div>
                </div>
            </div>
            <button onclick="checkExercise9()" class="check-button mt-6">Check Answers</button>
        </div>

        <!-- Exercise 10: WRITING TASK 1 -->
        <div class="exercise-section">
            <h2 class="exercise-title">Unit 3: Exercise 10 - WRITING TASK 1</h2>
            <p class="question-text">You should spend about 20 minutes on this task. The chart shows the average number of hours each day that Chinese, American, Turkish and Brazilian tourists spent doing leisure activities while on holiday in Greece in August 2015.<br>Summarise the chart by selecting and reporting the main features and make comparisons where relevant.<br>Write at least 150 words.</p>
            <div class="image-container">
                <img src="https://placehold.co/600x400/E0F2FE/3B82F6" alt="Holiday leisure activities chart">
            </div>
            <div class="mb-4">
                <label for="student_post" class="block text-gray-700 font-medium mb-2">Student post:</label>
                <textarea id="student_post" class="textarea-field" rows="10" placeholder="Write your summary here..."></textarea>
            </div>
            <button onclick="submitWritingTask()" class="check-button mt-6">Submit Writing Task</button>
            <div id="feedback_writing_task" class="feedback-message"></div>
        </div>
    </div>

    <script>
        // Helper function to display feedback
        function showFeedback(elementId, isCorrect, message) {
            const feedbackElement = document.getElementById(elementId);
            if (!feedbackElement) { // Added null check
                console.error(`Feedback element with ID ${elementId} not found.`);
                return; // Exit if element is null to prevent error
            }
            feedbackElement.textContent = message;
            feedbackElement.style.display = 'block';
            if (isCorrect) {
                feedbackElement.className = 'feedback-message correct';
            } else {
                feedbackElement.className = 'feedback-message incorrect';
            }
        }

        // Exercise 1 Logic
        function checkExercise1() {
            const answers = {
                'ex1_q1': 'This is a bar chart.', // Assuming image 1 is bar chart
                'ex1_q2': 'This is a pie chart.', // Assuming image 2 is pie chart
                'ex1_q3': 'This is a line graph.' // Assuming image 3 is line graph
            };

            for (const key in answers) {
                const input = document.getElementById(key);
                const userAnswer = input.value.trim();
                const correctAnswer = answers[key].trim();
                if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                    showFeedback(`feedback_${key}`, true, 'Correct!');
                } else {
                    showFeedback(`feedback_${key}`, false, `Incorrect. Please try again.`); // Removed correct answer
                }
            }
        }

        // Exercise 2 Logic (Drag and Drop)
        let draggedItem = null;

        document.querySelectorAll('.drag-item').forEach(item => {
            item.addEventListener('dragstart', (e) => {
                draggedItem = e.target;
                e.dataTransfer.setData('text/plain', e.target.dataset.word);
                setTimeout(() => {
                    e.target.style.display = 'none';
                }, 0);
            });

            item.addEventListener('dragend', (e) => {
                setTimeout(() => {
                    if (draggedItem) { // Only show if it wasn't dropped into a target
                        draggedItem.style.display = 'inline-block';
                    }
                    draggedItem = null;
                }, 0);
            });
        });

        document.querySelectorAll('.drop-target').forEach(target => {
            target.addEventListener('dragover', (e) => {
                e.preventDefault(); // Allow drop
                target.classList.add('hover');
            });

            target.addEventListener('dragleave', () => {
                target.classList.remove('hover');
            });

            target.addEventListener('drop', (e) => {
                e.preventDefault();
                target.classList.remove('hover');
                const data = e.dataTransfer.getData('text/plain');

                // If target already has content, put it back to word bank
                if (target.dataset.currentWord) {
                    const existingWord = target.dataset.currentWord;
                    const existingItem = document.querySelector(`.drag-item[data-word="${existingWord}"]`);
                    if (existingItem) {
                        existingItem.style.display = 'inline-block';
                    }
                }

                target.textContent = data;
                target.dataset.currentWord = data;
                target.classList.add('filled');
                if (draggedItem) {
                    draggedItem.style.display = 'none'; // Hide the original item
                    draggedItem = null; // Clear draggedItem after successful drop
                }
            });
        });

        function checkExercise2() {
            const dropTargets = {
                'ex2_drop1': 'different age groups',
                'ex2_drop2': 'money spent',
                'ex2_drop3': 'data',
                'ex2_drop4': 'Axis'
            };

            for (const key in dropTargets) {
                const target = document.getElementById(key);
                const userAnswer = target.dataset.currentWord;
                const correctAnswer = dropTargets[key];
                if (userAnswer && userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                    showFeedback(`feedback_ex2_q${key.slice(-1)}`, true, 'Correct!');
                } else {
                    showFeedback(`feedback_ex2_q${key.slice(-1)}`, false, `Incorrect. Please try again.`); // Removed correct answer
                }
            }
        }

        // Exercise 3 Logic (Multiple Choice)
        function checkExercise3() {
            const answers = {
                'ex3_q1': 'music concerts',
                'ex3_q2': 'about $14 million',
                'ex3_q3': 'music concerts',
                'ex3_q4': 'the cinema and music concerts',
                'ex3_q5': 'about $10 million'
            };

            for (const key in answers) {
                const select = document.getElementById(key);
                const userAnswer = select.value;
                const correctAnswer = answers[key];
                if (userAnswer === correctAnswer) {
                    showFeedback(`feedback_${key}`, true, 'Correct!');
                } else {
                    showFeedback(`feedback_${key}`, false, `Incorrect. Please try again.`); // Removed correct answer
                }
            }
        }

        // Exercise 4 Logic (Drag and Drop)
        // Reusing drag-item and drop-target logic from Exercise 2, but with specific IDs
        document.querySelectorAll('.exercise-section:nth-of-type(4) .drag-item').forEach(item => {
            item.addEventListener('dragstart', (e) => {
                draggedItem = e.target;
                e.dataTransfer.setData('text/plain', e.target.dataset.word);
                setTimeout(() => { e.target.style.display = 'none'; }, 0);
            });
            item.addEventListener('dragend', (e) => {
                setTimeout(() => {
                    if (draggedItem) {
                        draggedItem.style.display = 'inline-block';
                    }
                    draggedItem = null;
                }, 0);
            });
        });

        document.querySelectorAll('.exercise-section:nth-of-type(4) .drop-target').forEach(target => {
            target.addEventListener('dragover', (e) => {
                e.preventDefault();
                target.classList.add('hover');
            });
            target.addEventListener('dragleave', () => {
                target.classList.remove('hover');
            });
            target.addEventListener('drop', (e) => {
                e.preventDefault();
                target.classList.remove('hover');
                const data = e.dataTransfer.getData('text/plain');

                if (target.dataset.currentWord) {
                    const existingWord = target.dataset.currentWord;
                    const existingItem = document.querySelector(`.exercise-section:nth-of-type(4) .drag-item[data-word="${existingWord}"]`);
                    if (existingItem) {
                        existingItem.style.display = 'inline-block';
                    }
                }

                target.textContent = data;
                target.dataset.currentWord = data;
                target.classList.add('filled');
                if (draggedItem) {
                    draggedItem.style.display = 'none';
                    draggedItem = null;
                }
            });
        });

        function checkExercise4() {
            const dropTargets = {
                'ex4_drop1': 'a main difference',
                'ex4_drop2': 'a similarity',
                'ex4_drop3': 'important numbers'
            };

            for (const key in dropTargets) {
                const target = document.getElementById(key);
                const userAnswer = target.dataset.currentWord;
                const correctAnswer = dropTargets[key];
                if (userAnswer && userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                    showFeedback(`feedback_${key}`, true, 'Correct!');
                } else {
                    showFeedback(`feedback_${key}`, false, `Incorrect. Please try again.`); // Removed correct answer
                }
            }
        }

        // Exercise 5 Logic (Fill in the blanks with drag-and-drop words)
        // Using input fields for fill-in-the-blanks, can be combined with drag-drop or direct typing
        function checkExercise5() {
            const answers = {
                'ex5_q1': 'highest',
                'ex5_q2': 'compared',
                'ex5_q3': '40-55',
                'ex5_q4': '18-25',
                'ex5_q5': 'total',
                'ex5_q6': 'category',
                'ex5_q7': 'money'
            };

            for (const key in answers) {
                const input = document.getElementById(key);
                const userAnswer = input.value.trim();
                const correctAnswer = answers[key].trim();
                if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                    showFeedback(`feedback_${key}`, true, 'Correct!');
                } else {
                    showFeedback(`feedback_${key}`, false, `Incorrect. Please try again.`); // Removed correct answer
                }
            }
        }

        // Exercise 6 Logic (Multiple Choice)
        function checkExercise6() {
            const answers = {
                'ex6_q1': 'meeting friends',
                'ex6_q2': 'reading',
                'ex6_q3': 'watching TV',
                'ex6_q4': '20% fewer',
                'ex6_q5': 'meeting friends'
            };

            for (const key in answers) {
                const select = document.getElementById(key);
                const userAnswer = select.value;
                const correctAnswer = answers[key];
                if (userAnswer === correctAnswer) {
                    showFeedback(`feedback_${key}`, true, 'Correct!');
                } else {
                    showFeedback(`feedback_${key}`, false, `Incorrect. Please try again.`); // Removed correct answer
                }
            }
        }

        // Exercise 7 Logic (Fill in the blanks)
        function checkExercise7() {
            const answers = {
                'ex7_q1': 'whereas',
                'ex7_q2': 'contrast',
                'ex7_q3': 'Similarly',
                'ex7_q4': 'same'
            };

            for (const key in answers) {
                const input = document.getElementById(key);
                const userAnswer = input.value.trim();
                const correctAnswer = answers[key].trim();
                if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                    showFeedback(`feedback_${key}`, true, 'Correct!');
                } else {
                    showFeedback(`feedback_${key}`, false, `Incorrect. Please try again.`); // Removed correct answer
                }
            }
        }

        // Exercise 8 Logic (Drag and Drop for full sentences)
        let draggedSentenceItem = null;

        document.querySelectorAll('.exercise-section:nth-of-type(8) .drag-item').forEach(item => {
            item.addEventListener('dragstart', (e) => {
                draggedSentenceItem = e.target;
                e.dataTransfer.setData('text/plain', e.target.dataset.word);
                setTimeout(() => {
                    e.target.style.display = 'none';
                }, 0);
            });

            item.addEventListener('dragend', (e) => {
                setTimeout(() => {
                    if (draggedSentenceItem) {
                        draggedSentenceItem.style.display = 'inline-block';
                    }
                    draggedSentenceItem = null;
                }, 0);
            });
        });

        document.querySelectorAll('.exercise-section:nth-of-type(8) .drop-target').forEach(target => {
            target.addEventListener('dragover', (e) => {
                e.preventDefault();
                target.classList.add('hover');
            });

            target.addEventListener('dragleave', () => {
                target.classList.remove('hover');
            });

            target.addEventListener('drop', (e) => {
                e.preventDefault();
                target.classList.remove('hover');
                const data = e.dataTransfer.getData('text/plain');

                if (target.dataset.currentWord) {
                    const existingWord = target.dataset.currentWord;
                    const existingItem = document.querySelector(`.exercise-section:nth-of-type(8) .drag-item[data-word="${existingWord}"]`);
                    if (existingItem) {
                        existingItem.style.display = 'inline-block';
                    }
                }

                target.textContent = data;
                target.dataset.currentWord = data;
                target.classList.add('filled');
                if (draggedSentenceItem) {
                    draggedSentenceItem.style.display = 'none';
                    draggedSentenceItem = null;
                }
            });
        });

        function checkExercise8() {
            const dropTargets = {
                'ex8_drop1': 'while 65% voted against.',
                'ex8_drop2': 'By contrast, my sister always eats in restaurants.',
                'ex8_drop3': 'whereas the worst thing is that it’s expensive.',
                'ex8_drop4': 'Similarly, my grandfather also skis every year.',
                'ex8_drop5': 'In the same way, about 65% of singers can read it.',
                'ex8_drop6': 'while my least favourite are romantic comedies.',
                'ex8_drop7': 'whereas all the adults cried.',
                'ex8_drop8': 'By contrast, Heart of Darkness is very short.'
            };

            for (const key in dropTargets) {
                const target = document.getElementById(key);
                const userAnswer = target.dataset.currentWord;
                const correctAnswer = dropTargets[key];
                if (userAnswer && userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                    showFeedback(`feedback_${key}`, true, 'Correct!');
                } else {
                    showFeedback(`feedback_${key}`, false, `Incorrect. Please try again.`); // Removed correct answer
                }
            }
        }

        // Exercise 9 Logic (Reorder sentences using drag and drop)
        let draggedElement = null;
        let originalParent = null;

        // Utility function to shuffle an array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // ES6 swap
            }
            return array;
        }

        function setupReorderExercise9() {
            const sentences = [
                {
                    id: 's1',
                    correctOrder: ["65% of", "music teachers", "voted in support", "while", "25% voted against."],
                    wordBankId: 'ex9_word_bank_s1',
                    orderContainerId: 'ex9_order1'
                },
                {
                    id: 's2',
                    correctOrder: ["My mother", "loves swimming.", "By contrast,", "my father hates it."],
                    wordBankId: 'ex9_word_bank_s2',
                    orderContainerId: 'ex9_order2'
                },
                {
                    id: 's3',
                    correctOrder: ["The best thing", "about skiing", "is that it's exciting", "whereas", "the worst thing", "is that it's cold."],
                    wordBankId: 'ex9_word_bank_s3',
                    orderContainerId: 'ex9_order3'
                },
                {
                    id: 's4',
                    correctOrder: ["My sister loves cooking.", "Similarly,", "my grandmother", "is also", "a good cook."],
                    wordBankId: 'ex9_word_bank_s4',
                    orderContainerId: 'ex9_order4'
                },
                {
                    id: 's5',
                    correctOrder: ["One third of dog", "owners don’t like dogs.", "In the same way,", "one third of cat", "owners don't like dogs."],
                    wordBankId: 'ex9_word_bank_s5',
                    orderContainerId: 'ex9_order5'
                }
            ];

            sentences.forEach(sentence => {
                const wordBank = document.getElementById(sentence.wordBankId);
                const orderContainer = document.getElementById(sentence.orderContainerId);

                // Create and shuffle items for the word bank
                let words = sentence.correctOrder.map(word => {
                    const span = document.createElement('span');
                    span.classList.add('order-item');
                    span.draggable = true;
                    span.dataset.word = word;
                    span.textContent = word;
                    return span;
                });

                words = shuffleArray(words); // Shuffle the words

                words.forEach(word => wordBank.appendChild(word));

                // Add drag event listeners to items in the word bank
                wordBank.querySelectorAll('.order-item').forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        draggedElement = e.target;
                        originalParent = e.target.parentNode; // Store original parent
                        e.dataTransfer.setData('text/plain', e.target.dataset.word);
                        setTimeout(() => e.target.style.opacity = '0.5', 0); // Hide during drag
                    });

                    item.addEventListener('dragend', (e) => {
                        // If the element is still hidden (meaning it wasn't dropped into a valid target),
                        // return it to its original parent and make it visible.
                        if (e.target.style.opacity === '0.5') {
                            originalParent.appendChild(e.target);
                            e.target.style.opacity = '1';
                        }
                        draggedElement = null;
                        originalParent = null;
                    });
                });

                // Add drop event listeners to the order container
                orderContainer.addEventListener('dragover', (e) => {
                    e.preventDefault(); // Allow drop
                    orderContainer.classList.add('hover');

                    if (draggedElement && draggedElement.parentNode !== orderContainer) {
                        // If dragging from outside this container, don't reorder within it yet.
                        return;
                    }

                    const afterElement = getDragAfterElement(orderContainer, e.clientX);
                    if (draggedElement) {
                        if (afterElement == null) {
                            orderContainer.appendChild(draggedElement);
                        } else {
                            orderContainer.insertBefore(draggedElement, afterElement);
                        }
                    }
                });

                orderContainer.addEventListener('dragleave', () => {
                    orderContainer.classList.remove('hover');
                });

                orderContainer.addEventListener('drop', (e) => {
                    e.preventDefault();
                    orderContainer.classList.remove('hover');

                    if (draggedElement && draggedElement.parentNode !== orderContainer) {
                        // If element is dropped from a word bank into this container
                        draggedElement.style.opacity = '1'; // Make it visible
                        orderContainer.appendChild(draggedElement); // Append it first, then reorder
                        const afterElement = getDragAfterElement(orderContainer, e.clientX);
                        if (afterElement == null) {
                            orderContainer.appendChild(draggedElement);
                        } else {
                            orderContainer.insertBefore(draggedElement, afterElement);
                        }
                    } else if (draggedElement) {
                        // If element is dropped within the same container (reordering), just make it visible
                        draggedElement.style.opacity = '1';
                    }
                });
            });

            // Helper for reordering within a container
            function getDragAfterElement(container, x) {
                const draggableElements = [...container.querySelectorAll('.order-item:not([style*="opacity: 0.5"])')]; // Exclude the currently dragging element
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = x - box.left - box.width / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: -Infinity, element: null }).element;
            }
        }

        // Define correct orders for Exercise 9 (kept for checking)
        const ex9_q1_order = ["65% of", "music teachers", "voted in support", "while", "25% voted against."];
        const ex9_q2_order = ["My mother", "loves swimming.", "By contrast,", "my father hates it."];
        const ex9_q3_order = ["The best thing", "about skiing", "is that it's exciting", "whereas", "the worst thing", "is that it's cold."];
        const ex9_q4_order = ["My sister loves cooking.", "Similarly,", "my grandmother", "is also", "a good cook."];
        const ex9_q5_order = ["One third of dog", "owners don’t like dogs.", "In the same way,", "one third of cat", "owners don't like dogs."];


        document.addEventListener('DOMContentLoaded', () => {
            setupReorderExercise9(); // Call the new setup function for Exercise 9
        });

        function checkExercise9() {
            const checkOrder = (containerId, correctOrder) => {
                const container = document.getElementById(containerId);
                const currentOrderElements = Array.from(container.querySelectorAll('.order-item'));
                const currentOrderWords = currentOrderElements.map(item => item.dataset.word);

                let isCorrect = true;
                if (currentOrderWords.length !== correctOrder.length) {
                    isCorrect = false;
                } else {
                    for (let i = 0; i < correctOrder.length; i++) {
                        if (currentOrderWords[i] !== correctOrder[i]) {
                            isCorrect = false;
                            break;
                        }
                    }
                }
                return isCorrect;
            };

            const results = {
                'ex9_q1': checkOrder('ex9_order1', ex9_q1_order),
                'ex9_q2': checkOrder('ex9_order2', ex9_q2_order),
                'ex9_q3': checkOrder('ex9_order3', ex9_q3_order),
                'ex9_q4': checkOrder('ex9_order4', ex9_q4_order),
                'ex9_q5': checkOrder('ex9_order5', ex9_q5_order)
            };

            for (const key in results) {
                if (results[key]) {
                    showFeedback(`feedback_${key}`, true, 'Correct!');
                } else {
                    let correctSentence = '';
                    if (key === 'ex9_q1') correctSentence = ex9_q1_order.join(' ');
                    else if (key === 'ex9_q2') correctSentence = ex9_q2_order.join(' ');
                    else if (key === 'ex9_q3') correctSentence = ex9_q3_order.join(' ');
                    else if (key === 'ex9_q4') correctSentence = ex9_q4_order.join(' ');
                    else if (key === 'ex9_q5') correctSentence = ex9_q5_order.join(' ');

                    showFeedback(`feedback_${key}`, false, `Incorrect. Please try again.`); // Removed correct answer
                }
            }
        }

        // Exercise 10 Logic (Writing Task - Placeholder for LLM feedback)
        async function submitWritingTask() {
            const studentPost = document.getElementById('student_post').value;
            const feedbackElement = document.getElementById('feedback_writing_task');

            if (studentPost.trim().length < 150) {
                showFeedback('feedback_writing_task', false, 'Please write at least 150 words for your summary.');
                return;
            }

            feedbackElement.textContent = 'Submitting your response for evaluation...';
            feedbackElement.className = 'feedback-message bg-blue-100 text-blue-800';
            feedbackElement.style.display = 'block';

            // Simulate LLM call
            // In a real application, you would send 'studentPost' to an LLM API
            // and get feedback. For this example, we'll use a placeholder.
            const prompt = `Evaluate the following IELTS Writing Task 1 summary based on the provided chart (Holiday leisure activities chart). Focus on Task Achievement (summarizing main features, making comparisons, word count), Coherence and Cohesion, Lexical Resource, and Grammatical Range and Accuracy. Provide constructive feedback.

            Chart Description: The chart shows the average number of hours each day that Chinese, American, Turkish and Brazilian tourists spent doing leisure activities (At the beach, Reading books, Visiting places) while on holiday in Greece in August 2015.

            Student's Summary:
            ${studentPost}`;

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will provide this at runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const llmFeedback = result.candidates[0].content.parts[0].text;
                    showFeedback('feedback_writing_task', true, `Feedback received:\n\n${llmFeedback}`);
                } else {
                    showFeedback('feedback_writing_task', false, 'Failed to get feedback from the AI. Please try again.');
                    console.error('LLM response structure unexpected:', result);
                }
            } catch (error) {
                showFeedback('feedback_writing_task', false, 'An error occurred while getting feedback: ' + error.message);
                console.error('Error calling LLM:', error);
            }
        }
    </script>
</body>
</html>
